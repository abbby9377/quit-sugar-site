<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>é£Ÿç‰©å¡è·¯é‡Œåˆ†æå™¨ï½œQuit Sugar</title>
  <meta name="description" content="ç™»å…¥å¾Œå³å¯ä½¿ç”¨é£Ÿç‰©å¡è·¯é‡Œåˆ†æå™¨ï¼Œç¶­æŒèˆ‡é¦–é ä¸€è‡´çš„è¦–è¦ºé¢¨æ ¼èˆ‡å°è¦½ã€‚" />
  <meta name="theme-color" content="#f472b6" />

  <script>
    (function hardLock() {
      document.documentElement.classList.add('auth-off'); // é è¨­é—œé–‰ç‹€æ…‹
      window.__qs_iframeGuard = { allowed: false };
      const nuke = () => {
        if (!window.__qs_iframeGuard.allowed) {
          document.querySelectorAll('iframe').forEach(el => el.remove());
        }
      };
      // 1) æ¥µæ—©æœŸï¼šDOM é‚„åœ¨å»ºç«‹æ™‚å°±æ””æˆª
      document.addEventListener('DOMContentLoaded', nuke, true);
      // 2) ä»»ä½•å¾ŒçºŒæ’å…¥ä¹Ÿç æ‰
      new MutationObserver(nuke).observe(document.documentElement, { childList: true, subtree: true });
      // 3) é¦–å±æœŸé–“ä¹Ÿå…ˆè—èµ·ä¾†ï¼ˆé¿å…é–ƒç¾ï¼‰
      const style = document.createElement('style');
      style.textContent = "html.auth-off #embed, html.auth-off iframe { display: none !important; }";
      document.head.appendChild(style);
    })();
  </script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;600;700;800&family=Noto+Serif+TC:wght@700&display=swap" rel="stylesheet">

  <style>
  :root{
    --bg:#ffffff; --panel:#ffffff; --ink:#0b1220; --muted:#475569; --line:#e5e7eb;
    --brand:#ec4899; --brand-2:#f472b6; --brand-3:#fb7185;
    --accent:#fdf2f8; --promo:#fff1f5; --danger:#ef4444;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;background:var(--bg);color:var(--ink);
    font-family:'Noto Sans TC',system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
  }
  img{max-width:100%;display:block}
  a{color:#2563eb;text-decoration:none}
  a:hover{text-decoration:underline}
  .wrap{max-width:1120px;margin:0 auto;padding:0 20px 80px}

  /* ä¿ƒéŠ·æ¢ */
  .promo{background:var(--promo);border-bottom:1px solid var(--line);text-align:center;padding:10px 12px;color:#7a294a;font-weight:700}
  .promo .btn{margin-left:10px;display:inline-flex;align-items:center;gap:8px;border:1px solid var(--line);padding:8px 14px;border-radius:999px;background:#fff;color:#0b1220;text-decoration:none}
  .promo .count{font-weight:800;margin-left:8px;color:#be185d}

  /* Headerï¼ˆèˆ‡é¦–é ä¸€è‡´ï¼‰ */
  header.site{position:sticky;top:0;background:#fff;z-index:20;border-bottom:1px solid var(--line)}
  .nav{display:flex;align-items:center;justify-content:space-between;gap:16px;padding:14px 0}
  .brand{display:flex;gap:12px;align-items:center}
  .logo{width:44px;height:44px;border-radius:14px;background:linear-gradient(135deg,var(--brand-2),var(--brand));display:grid;place-items:center;color:#fff;font-weight:900}
  .title{margin:0;font-size:22px;letter-spacing:.3px}
  .nav-links{display:flex;gap:16px;align-items:center}
  .nav-links a.active{font-weight:800;color:#1d4ed8}

  /* Buttons */
  .btn{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--line);padding:12px 16px;border-radius:999px;background:#fff;color:var(--ink);cursor:pointer;white-space:nowrap}
  .btn.primary{background:linear-gradient(135deg,var(--brand-2),var(--brand));color:#fff;border:none;font-weight:800}
  .btn.ghost{background:transparent}
  .btn[disabled]{opacity:.6;cursor:not-allowed}

  /* === æ¼¢å ¡éˆ• + è¡Œå‹•æŠ½å±œï¼ˆé¡¯çœ¼ç‰ˆï¼‰ === */
  .burger{
    display:none;
    width:44px;height:44px;
    border:1px solid #e5e7eb;border-radius:12px;background:#fff;
    cursor:pointer;
    align-items:center;justify-content:center;flex-direction:column;gap:5px;
    box-shadow:0 6px 16px rgba(15,23,42,.10);
  }
  .burger .bar{display:block;width:22px;height:3px;background:#0b1220;border-radius:2px}
  .burger .label{font-size:11px;font-weight:800;color:#0b1220;letter-spacing:.02em;line-height:1}
  .mobile-drawer{
    position:fixed;inset:0 auto 0 0;width:86vw;max-width:320px;background:#fff;
    border-right:1px solid #e5e7eb;box-shadow:8px 0 30px rgba(15,23,42,.18);
    transform:translateX(-100%);transition:transform .25s ease;z-index:60;
    display:flex;flex-direction:column;
  }
  .mobile-drawer.open{transform:none}
  .m-head{
    display:flex;justify-content:space-between;align-items:center;padding:14px;
    border-bottom:1px solid #e5e7eb;
    background:linear-gradient(135deg,#f472b6,#ec4899);color:#fff;
  }
  .m-brand{width:36px;height:36px;border-radius:12px;display:grid;place-items:center;background:rgba(255,255,255,.2);color:#fff;font-weight:900}
  .m-close{border:none;background:#fff;width:36px;height:36px;border-radius:10px;cursor:pointer}
  .m-links{display:flex;flex-direction:column;gap:8px;padding:14px}
  .m-links a{display:block;padding:14px 12px;border:1px solid #e5e7eb;border-radius:12px;background:#fff;color:#0b1220;text-decoration:none;font-weight:700}
  .m-links a.active{border-color:#d946ef;background:#fdf4ff}
  .m-links .btn{justify-content:center}
  .backdrop{position:fixed;inset:0;background:rgba(0,0,0,.38);z-index:55}
  .backdrop[hidden]{display:none}
  @media (max-width:860px){
    .burger{display:inline-flex}
    .nav .nav-links{display:none}
  }

  /* Heroï¼ˆèˆ‡é¦–é ä¸€è‡´ï¼‰ */
  .hero{background:linear-gradient(180deg,#fff,#fff 34%,#fdf2f8 34%,#fdf2f8);border-bottom:1px solid var(--line)}
  .hero-inner{display:grid;gap:26px;grid-template-columns:1.1fr 1fr;align-items:center;padding:34px 0}
  .eyebrow{display:inline-block;color:#a21caf;background:#fce7f3;border:1px solid #fbcfe8;padding:4px 10px;border-radius:999px;font-weight:700;font-size:12px;margin-bottom:8px}
  .hero h1{font-family:"Noto Serif TC",serif;font-weight:700;font-size:34px;line-height:1.25;margin:0 0 10px;letter-spacing:.2px}
  .hero p{color:#475569;margin:0 0 16px;max-width:60ch}
  .hero-media{justify-self:end}
  .hero-media img{width:min(480px,100%);height:auto;border-radius:24px;border:1px solid var(--line);box-shadow:0 20px 60px rgba(236,72,153,.15)}

  /* å¡ç‰‡èˆ‡è¡¨å–® */
  .card{background:#fff;border:1px solid var(--line);border-radius:18px;padding:18px;box-shadow:0 6px 20px rgba(236,72,153,.08)}
  .muted{color:var(--muted)}
  .row2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  input{width:100%;background:#fff;border:1px solid #d1d5db;padding:10px 12px;border-radius:12px;color:#var(--ink);font:inherit}
  .error{border-left:3px solid var(--danger);padding:10px 12px;background:#fff5f5;border-radius:12px}

  /* Embed å€å¡Šï¼ˆåªæœ‰ç™»å…¥å¾Œæ‰æœƒé¡¯ç¤ºï¼‰ */
  .embed-wrap{border:1px solid var(--line);border-radius:18px;overflow:hidden;background:#fff}
  .embed-head{display:flex;justify-content:space-between;align-items:center;gap:12px;padding:12px 14px;border-bottom:1px solid var(--line);background:linear-gradient(135deg,#fff1f2,#fdf2f8 40%,#eef2ff)}
  .embed-head .title{font-weight:800;color:#0f172a}
  .embed-body{position:relative}
  .embed-skel{position:absolute;inset:0;display:grid;place-items:center;background:#fff}
  .embed-skel .dot{width:10px;height:10px;border-radius:999px;background:#f0abfc;animation:b 1.2s infinite alternate}
  .embed-skel .dot:nth-child(2){animation-delay:.2s}
  .embed-skel .dot:nth-child(3){animation-delay:.4s}
  @keyframes b{to{transform:translateY(-6px);opacity:.6}}
  iframe{width:100%;border:0;display:block;height:900px}

  footer{margin-top:32px;color:#94a3b8;text-align:center}
  </style>

  <script>
    window.onerror = function(msg, src, line, col) {
      var box = document.getElementById('auth-error');
      if (box) { box.style.display = 'block'; box.textContent = 'å‰ç«¯éŒ¯èª¤ï¼š ' + msg + ' (' + src + ':' + line + ':' + col + ')'; }
    };
  </script>

  <script>
    (function loadSupabaseSDK() {
      var primary = "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.4/dist/umd/supabase.min.js";
      var fallback = "https://unpkg.com/@supabase/supabase-js@2.45.4/dist/umd/supabase.min.js";
      function append(src) {
        var s = document.createElement('script');
        s.src = src; s.defer = true;
        s.onload = function(){ window.__supabaseReady = true; };
        s.onerror = function(){
          if (src === primary) {
            append(fallback);
          } else {
            var el = document.getElementById('auth-error');
            if (el) { el.style.display = 'block'; el.textContent = 'è¼‰å…¥ Supabase SDK å¤±æ•—ï¼Œæš«æ™‚ç„¡æ³•é©—è­‰ç™»å…¥ç‹€æ…‹ã€‚'; }
          }
        };
        document.head.appendChild(s);
      }
      append(primary);
    })();
  </script>
</head>
<body>

  <!-- ä¿ƒéŠ·æ¢ï¼ˆèµ·å§‹ï¼š47:59:56ï¼‰ -->
  <div class="promo" role="region" aria-label="ä¿ƒéŠ·è¨Šæ¯">
    8 é€±æˆ’ç³– Resetï½œé¦–è³¼ 5 æŠ˜å€’æ•¸ <span class="count" id="promo-count" aria-live="polite">47:59:56</span>
    <a class="btn" href="./ebooks.html#bundle" aria-label="ç«‹å³åŠ å…¥">ç«‹å³åŠ å…¥</a>
  </div>

  <header class="site" role="banner">
    <div class="wrap nav">
      <!-- è¡Œå‹•ç‰ˆæ¼¢å ¡éˆ•ï¼ˆç›´å‘ä¸‰æ¢ï¼‹é™°å½±ï¼‹ã€Œé¸å–®ã€æ¨™ï¼‰ -->
      <button id="m-burger" class="burger" aria-label="é–‹å•Ÿå°è¦½" aria-controls="m-menu" aria-expanded="false">
        <span class="bar"></span>
        <span class="bar"></span>
        <span class="bar"></span>
        <span class="label">é¸å–®</span>
      </button>

      <div class="brand">
        <div class="logo" aria-hidden="true">QS</div>
        <div>
          <h1 class="title" style="margin:0">æˆ’ç³–è¨ˆç•« Quit Sugar</h1>
          <small class="muted">æº«æŸ”é–‹å§‹ãƒ»æŒçºŒè¨˜éŒ„ãƒ»çœ‹è¦‹æ”¹è®Š</small>
        </div>
      </div>

      <nav class="nav-links" aria-label="ä¸»å°è¦½">
        <a href="./">æˆ’ç³–é¦–é </a>
        <a href="./element-quiz.html">äº”è¡Œæ¸¬é©—</a>
        <a class="active" href="./analyzer.html">é£Ÿç‰©å¡è·¯é‡Œåˆ†æå™¨</a>
        <a href="./ebooks.html">é›»å­æ›¸å•†åº—</a>
        <a id="nav-auth" class="btn primary" href="./#auth">åŠ å…¥æŒ‘æˆ° / ç™»å…¥</a>
      </nav>
    </div>
  </header>

  <!-- Mobile æŠ½å±œå°è¦½èˆ‡é®ç½© -->
  <aside id="m-menu" class="mobile-drawer" aria-hidden="true">
    <header class="m-head">
      <div class="m-brand">QS</div>
      <button id="m-close" class="m-close" aria-label="é—œé–‰å°è¦½">âœ•</button>
    </header>
    <nav id="m-nav" class="m-links" aria-label="è¡Œå‹•ç‰ˆå°è¦½"></nav>
  </aside>
  <div id="m-backdrop" class="backdrop" hidden></div>

  <section class="hero">
    <div class="wrap hero-inner">
      <div>
        <span class="eyebrow">å·¥å…·</span>
        <h1>é£Ÿç‰©å¡è·¯é‡Œåˆ†æå™¨</h1>
        <p>ç‚ºäº†ä¿è­·ä½ çš„å€‹äººè³‡æ–™èˆ‡åå¥½è¨­å®šï¼Œæœ¬å·¥å…·<strong>éœ€ç™»å…¥</strong>æ‰å¯ä½¿ç”¨ã€‚</p>
      </div>
      <div class="hero-media" aria-hidden="true">
        <picture>
          <source srcset="./assets/feature-tasty-low-sugar.webp" type="image/webp">
          <img src="./assets/feature-tasty-low-sugar.jpg" alt="ä½ç³–æ—©é¤ç¢—ï¼šç‡•éº¥ã€å …æœèˆ‡æ°´æœ" fetchpriority="high" style="max-width:300px;width:70%;height:auto;">
        </picture>
      </div>
    </div>
  </section>

  <main class="wrap" role="main" style="margin-top:18px">
    <section id="login-wall" class="card" style="display:none">
      <span class="muted">ç™»å…¥å¾Œå³å¯é–‹å§‹ä½¿ç”¨åˆ†æå™¨</span>
      <h2 style="margin:6px 0 10px">ç™»å…¥ / è¨»å†Š</h2>
      <div class="row2">
        <input id="email" placeholder="Emailï¼ˆå»ºè­°æ‰‹å‹•è¼¸å…¥ï¼‰" autocomplete="username" />
        <input id="password" placeholder="å¯†ç¢¼ï¼ˆè‡³å°‘ 6 ç¢¼ï¼‰" type="password" autocomplete="current-password" />
      </div>
      <div class="row2" style="margin-top:8px">
        <button class="btn primary" id="btn-login">ç™»å…¥</button>
        <button class="btn" id="btn-signup">è¨»å†Š</button>
      </div>
      <div id="auth-error" class="error" style="display:none;margin-top:10px"></div>
      <small class="muted">ä¹Ÿå¯å›åˆ°<a href="./#auth">é¦–é ç™»å…¥</a>å¾Œå†å›ä¾†ã€‚</small>
    </section>

    <section id="embed" class="card embed-wrap" style="display:none">
      <div class="embed-head">
        <div class="title">å¤–éƒ¨åˆ†æå™¨ï¼ˆåµŒå…¥ï¼‰</div>
        <div class="muted" id="user-badge">â€”</div>
      </div>
      <div class="embed-body">
        <div id="skel" class="embed-skel">
          <div style="display:flex;gap:8px;align-items:center">
            <div class="dot"></div><div class="dot"></div><div class="dot"></div>
          </div>
        </div>
        <div id="iframe-slot"></div>
      </div>
    </section>

    <noscript>
      <div class="card" style="margin-top:12px">
        æœ¬é éœ€è¦å•Ÿç”¨ JavaScript ä»¥é©—è­‰ç™»å…¥ï¼Œä¸¦åœ¨ç™»å…¥å¾Œè¼‰å…¥åˆ†æå™¨ã€‚
      </div>
    </noscript>
  </main>

  <footer class="wrap" role="contentinfo">
    <p>Â© 2025 Quit Sugar. GitHub Pages</p>
  </footer>

<script>
  // ===== ç­‰å¾… SDK =====
  async function waitSupabaseReady(ms = 4000) {
    const start = Date.now();
    while (!window.supabase && Date.now() - start < ms) {
      await new Promise(r => setTimeout(r, 50));
    }
    return !!window.supabase;
  }

  // ===== å·¥å…· =====
  function normalizeEmail(raw){ return (raw ?? '').normalize('NFKC').replace(/[\u200B-\u200D\uFEFF]/g, '').trim(); }
  function basicEmailOK(s){ return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s); }
  const $ = id => document.getElementById(id);
  function showErr(msg){ const el=$('auth-error'); if(!el) return; el.style.display='block'; el.textContent=msg; }
  function hideErr(){ const el=$('auth-error'); if(!el) return; el.style.display='none'; el.textContent=''; }

  // ===== ä¸»æµç¨‹ =====
  window.addEventListener('DOMContentLoaded', async () => {
    // ä¿ƒéŠ·å€’æ•¸ï¼ˆå¾ 47:59:56 é–‹å§‹ï¼‰
    (function promoCountdown(){
      const el = document.getElementById('promo-count'); if(!el) return;
      let sec = 47*3600 + 59*60 + 56;
      function tick(){
        const h = String(Math.floor(sec/3600)).padStart(2,'0');
        const m = String(Math.floor((sec%3600)/60)).padStart(2,'0');
        const s = String(sec%60).padStart(2,'0');
        el.textContent = `${h}:${m}:${s}`;
        if (sec > 0) sec--;
      }
      tick();
      setInterval(tick, 1000);
    })();

    const ok = await waitSupabaseReady(4000);
    if (!ok) {
      // SDK å¤±æ•— â†’ ä¿æŒé–å®šï¼Œåªé¡¯ç¤ºç™»å…¥ç‰†
      $('login-wall').style.display = 'block';
      showErr('Supabase SDK æœªè¼‰å…¥å®Œæˆï¼Œæš«æ™‚ç„¡æ³•é©—è­‰ç™»å…¥ç‹€æ…‹ã€‚');
      return;
    }

    // Supabase åˆå§‹åŒ–ï¼ˆèˆ‡é¦–é ç›¸åŒå°ˆæ¡ˆï¼‰
    const SUPABASE_URL = "https://scquprvywjtuvcxxfsco.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNjcXVwcnZ5d2p0dXZjeHhmc2NvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4MzAxMTQsImV4cCI6MjA3MTQwNjExNH0.iUZ_lI-mHoGoz2NfPTifYe44zieUIBUREF6fxsry97I";
    const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
      auth: { persistSession: true, autoRefreshToken: true, detectSessionInUrl: false }
    });

    async function renderBySession(){
      const { data:{ session } } = await supabaseClient.auth.getSession();
      const navAuth = document.getElementById('nav-auth');

      if(session){
        // è§£é–ï¼šå…è¨±å»ºç«‹/å­˜åœ¨ iframe
        window.__qs_iframeGuard.allowed = true;
        document.documentElement.classList.remove('auth-off');
        document.documentElement.classList.add('auth-on');

        if(navAuth){ navAuth.textContent = session.user?.email || 'å·²ç™»å…¥'; navAuth.href = 'javascript:void(0)'; }
        $('login-wall').style.display = 'none';
        $('embed').style.display = 'block';
        $('user-badge').textContent = 'ğŸ‘¤ ' + (session.user?.email || 'å·²ç™»å…¥');
        ensureIframe();
      }else{
        // ä¸Šé–ï¼šæ¸…æ‰ä»»ä½• iframeï¼Œé¡¯ç¤ºç™»å…¥ç‰†
        window.__qs_iframeGuard.allowed = false;
        document.documentElement.classList.add('auth-off');
        if(navAuth){ navAuth.textContent = 'åŠ å…¥æŒ‘æˆ° / ç™»å…¥'; navAuth.href = './#auth'; }
        $('embed').style.display = 'none';
        $('login-wall').style.display = 'block';
        destroyIframe();
        document.querySelectorAll('iframe').forEach(el => el.remove());
      }
    }

    // åªåœ¨ç™»å…¥å¾Œå»ºç«‹ iframeï¼›æœªç™»å…¥æ™‚å®Œå…¨ä¸å»ºç«‹
    let iframeInited = false;
    function ensureIframe(){
      if(iframeInited || !window.__qs_iframeGuard.allowed) return;
      const slot = $('iframe-slot');
      const frame = document.createElement('iframe');
      frame.id = 'fc-embed';
      frame.title = 'Food Calorie Analyzerï¼ˆå¤–éƒ¨ç«™ï¼‰';
      frame.loading = 'lazy';
      frame.referrerPolicy = 'no-referrer-when-downgrade';
      frame.sandbox = "allow-same-origin allow-scripts allow-forms";
      frame.src = 'https://abbby9377.github.io/food-calorie-analyzer/';
      frame.addEventListener('load', ()=>{ const skel=$('skel'); if(skel) skel.style.display='none'; });
      slot.appendChild(frame);
      // è‡ªå‹•é«˜åº¦ï¼ˆåŒæºå¯è®€ï¼›è·¨ç¶²åŸŸä»¥é è¨­é«˜åº¦ç‚ºä¸»ï¼‰
      setTimeout(()=>pollHeight(frame), 200);
      setTimeout(()=>pollHeight(frame), 800);
      setTimeout(()=>pollHeight(frame), 1500);
      setInterval(()=>pollHeight(frame), 700);
      iframeInited = true;
    }
    function destroyIframe(){
      if(!iframeInited) return;
      const slot = $('iframe-slot');
      slot.innerHTML = '';
      const skel=$('skel'); if(skel) skel.style.display='grid';
      iframeInited = false;
    }

    function pollHeight(frame){
      try {
        var doc = frame.contentDocument || frame.contentWindow.document;
        if(doc){
          var h = Math.max(doc.body.scrollHeight, doc.documentElement.scrollHeight);
          if(h && Math.abs(h - parseInt(frame.style.height||'0')) > 4){
            frame.style.height = Math.max(700, h) + 'px';
          }
        }
      } catch (e) { /* è·¨ç¶²åŸŸï¼šå¿½ç•¥ */ }
    }

    // ç™»å…¥ / è¨»å†Š
    document.getElementById('btn-login').addEventListener('click', async ()=>{
      hideErr();
      const email = normalizeEmail(document.getElementById('email').value);
      const password = document.getElementById('password').value;
      if(!basicEmailOK(email)) return showErr('è«‹è¼¸å…¥æœ‰æ•ˆçš„ Email');
      if((password||'').length < 6) return showErr('å¯†ç¢¼è‡³å°‘ 6 ç¢¼');
      const { error } = await supabaseClient.auth.signInWithPassword({ email, password });
      if(error) return showErr('ç™»å…¥å¤±æ•—ï¼š' + (error.message || 'æœªçŸ¥éŒ¯èª¤'));
      await renderBySession();
    });

    document.getElementById('btn-signup').addEventListener('click', async ()=>{
      hideErr();
      const email = normalizeEmail(document.getElementById('email').value);
      const password = document.getElementById('password').value;
      if(!basicEmailOK(email)) return showErr('è«‹è¼¸å…¥æœ‰æ•ˆçš„ Emailï¼ˆé¿å…å…¨å½¢èˆ‡å¤šé¤˜ç©ºç™½ï¼‰');
      if((password||'').length < 6) return showErr('å¯†ç¢¼è‡³å°‘ 6 ç¢¼');
      const { data, error } = await supabaseClient.auth.signUp({ email, password });
      if(error) return showErr('è¨»å†Šå¤±æ•—ï¼š' + (error.message || 'æœªçŸ¥éŒ¯èª¤'));
      if(!data.session){ return showErr('è‹¥å•Ÿç”¨ä¿¡ç®±é©—è­‰ï¼Œè«‹è‡³ä¿¡ç®±æ”¶ä¿¡å¾Œå†å›ä¾†æŒ‰ã€Œç™»å…¥ã€ã€‚'); }
      await renderBySession();
    });

    // åˆå§‹åŒ–èˆ‡ç‹€æ…‹ç›£è½
    await renderBySession();
    supabaseClient.auth.onAuthStateChange((_evt, _session)=>{ renderBySession(); });
  });

  /* === æ¼¢å ¡æŠ½å±œå°è¦½ JS === */
  (function(){
    var desktopNav = document.querySelector('.nav-links');
    var mobileNav  = document.getElementById('m-nav');
    var burger     = document.getElementById('m-burger');
    var drawer     = document.getElementById('m-menu');
    var backdrop   = document.getElementById('m-backdrop');
    var closeBtn   = document.getElementById('m-close');
    if (!desktopNav || !mobileNav || !burger || !drawer || !backdrop || !closeBtn) return;

    // è¤‡è£½æ¡Œé¢å°è¦½å…§å®¹åˆ°è¡Œå‹•æŠ½å±œ
    mobileNav.innerHTML = desktopNav.innerHTML;

    function openDrawer(){
      drawer.classList.add('open');
      backdrop.hidden = false;
      burger.setAttribute('aria-expanded','true');
      document.body.style.overflow = 'hidden';
    }
    function closeDrawer(){
      drawer.classList.remove('open');
      backdrop.hidden = true;
      burger.setAttribute('aria-expanded','false');
      document.body.style.overflow = '';
    }
    burger.addEventListener('click', openDrawer);
    closeBtn.addEventListener('click', closeDrawer);
    backdrop.addEventListener('click', closeDrawer);
    document.addEventListener('keydown', function(e){ if(e.key === 'Escape') closeDrawer(); });
    mobileNav.addEventListener('click', function(e){ if (e.target.tagName === 'A') closeDrawer(); });
  })();
</script>
</body>
</html>
