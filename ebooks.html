<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>電子書商店｜Quit Sugar</title>
  <meta name="description" content="戒糖主題電子書商店：一次入手 8 週戒糖入門，完整指南讓您無痛戒糖。結帳導向 Gumroad，輕鬆安全購買。" />
  <meta name="theme-color" content="#f472b6" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;600;700;800&family=Noto+Serif+TC:wght@700&display=swap" rel="stylesheet">

  <style>
  :root{
    --bg:#ffffff; --panel:#ffffff; --ink:#0b1220; --muted:#475569; --line:#e5e7eb;
    --brand:#ec4899; --brand-2:#f472b6; --brand-3:#fb7185;
    --promo:#fff1f5; --accent:#fdf2f8;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;background:var(--bg);color:var(--ink);
    font-family:'Noto Sans TC',system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
  }
  img{max-width:100%;display:block}
  a{color:#2563eb;text-decoration:none}
  a:hover{text-decoration:underline}
  .wrap{max-width:1120px;margin:0 auto;padding:0 20px 80px}
  .muted{color:var(--muted)}

  /* 促銷條（與首頁一致） */
  .promo{
    background:var(--promo);border-bottom:1px solid var(--line);
    text-align:center;padding:10px 12px;color:#7a294a;font-weight:700
  }
  .promo .btn{margin-left:10px}
  .promo .count{font-weight:800;margin-left:8px;color:#be185d}

  /* Header（與首頁一致 + 顯眼漢堡） */
  header.site{position:sticky;top:0;background:#fff;z-index:20;border-bottom:1px solid var(--line)}
  .nav{display:flex;align-items:center;justify-content:space-between;gap:16px;padding:14px 0}
  .brand{display:flex;gap:12px;align-items:center}
  .logo{width:44px;height:44px;border-radius:14px;background:linear-gradient(135deg,var(--brand-2),var(--brand));display:grid;place-items:center;color:#fff;font-weight:900}
  .title{margin:0;font-size:22px;letter-spacing:.3px}
  .nav-links{display:flex;gap:16px;align-items:center}
  .nav-links a.active{font-weight:800;color:#1d4ed8}

  /* Buttons（與首頁一致） */
  .btn{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--line);
        padding:12px 16px;border-radius:999px;background:#fff;color:var(--ink);cursor:pointer;white-space:nowrap}
  .btn.primary{background:linear-gradient(135deg,var(--brand-2),var(--brand));color:#fff;border:none;font-weight:800}
  .btn.ghost{background:transparent}
  .btn[disabled]{opacity:.6;cursor:not-allowed}

  /* === 顯眼的漢堡鈕 + 行動抽屜 === */
  .burger{
    display:none;
    width:44px;height:44px;
    border:1px solid #e5e7eb;border-radius:12px;background:#fff;
    cursor:pointer;align-items:center;justify-content:center;
    flex-direction:column;gap:5px;
    box-shadow:0 6px 16px rgba(15,23,42,.10);
  }
  .burger .bar{display:block;width:22px;height:3px;background:#0b1220;border-radius:2px}
  .burger .label{font-size:11px;font-weight:800;color:#0b1220;letter-spacing:.02em;line-height:1}
  .mobile-drawer{
    position:fixed;inset:0 auto 0 0;width:86vw;max-width:320px;background:#fff;
    border-right:1px solid #e5e7eb;box-shadow:8px 0 30px rgba(15,23,42,.18);
    transform:translateX(-100%);transition:transform .25s ease;z-index:60;
    display:flex;flex-direction:column;
  }
  .mobile-drawer.open{transform:none}
  .m-head{
    display:flex;justify-content:space-between;align-items:center;padding:14px;
    border-bottom:1px solid #e5e7eb;
    background:linear-gradient(135deg,#f472b6,#ec4899);color:#fff;
  }
  .m-brand{width:36px;height:36px;border-radius:12px;display:grid;place-items:center;background:rgba(255,255,255,.2);color:#fff;font-weight:900}
  .m-close{border:none;background:#fff;width:36px;height:36px;border-radius:10px;cursor:pointer}
  .m-links{display:flex;flex-direction:column;gap:8px;padding:14px}
  .m-links a{display:block;padding:14px 12px;border:1px solid #e5e7eb;border-radius:12px;background:#fff;color:#0b1220;text-decoration:none;font-weight:700}
  .m-links a.active{border-color:#d946ef;background:#fdf4ff}
  .m-links .btn{justify-content:center}
  .backdrop{position:fixed;inset:0;background:rgba(0,0,0,.38);z-index:55}
  .backdrop[hidden]{display:none}
  @media (max-width:860px){
    .burger{display:inline-flex}
    .nav .nav-links{display:none}
  }

  /* Hero（與首頁一致的版型/漸層） */
  .hero{background:linear-gradient(180deg,#fff,#fff 34%,#fdf2f8 34%,#fdf2f8);border-bottom:1px solid var(--line)}
  .hero-inner{display:grid;gap:26px;grid-template-columns:1.1fr 1fr;align-items:center;padding:34px 0}
  .eyebrow{display:inline-block;color:#a21caf;background:#fce7f3;border:1px solid #fbcfe8;padding:4px 10px;border-radius:999px;font-weight:700;font-size:12px;margin-bottom:8px}
  .hero h1{font-family:"Noto Serif TC",serif;font-weight:700;font-size:34px;line-height:1.25;margin:0 0 10px;letter-spacing:.2px}
  .hero p{color:#475569;margin:0 0 16px;max-width:60ch}
  .hero-media{justify-self:end}
  .hero-media img{width:min(420px,100%);height:auto;border-radius:24px;border:1px solid var(--line);box-shadow:0 20px 60px rgba(236,72,153,.15)}

  /* 工具列（過濾/排序） */
  .toolbar{display:flex;flex-wrap:wrap;gap:8px;justify-content:space-between;align-items:center;margin:18px 0 14px}
  .chips{display:flex;flex-wrap:wrap;gap:8px}
  .chip{padding:8px 12px;border:1px solid var(--line);border-radius:999px;background:#fff;cursor:pointer}
  .chip.active{border-color:#d946ef;color:#a21caf;background:#fdf4ff}
  select.sort{border:1px solid var(--line);border-radius:12px;padding:8px 10px;background:#fff}

  /* 商品格狀（與首頁卡片風格一致） */
  .grid{display:grid;gap:14px;grid-template-columns:repeat(1,1fr)}
  @media(min-width:720px){ .grid{grid-template-columns:repeat(2,1fr)} }
  @media(min-width:1024px){ .grid{grid-template-columns:repeat(3,1fr)} }
  .card{background:#fff;border:1px solid var(--line);border-radius:18px;padding:14px;
        box-shadow:0 6px 20px rgba(236,72,153,.08)}
  .product .cover{width:100%;height:auto;border-radius:14px;border:1px solid var(--line)}
  .product h4{margin:10px 0 6px;font-size:16px}
  .product .muted{font-size:14px}
  .price{display:flex;gap:8px;align-items:center}
  .price .now{font-weight:800}
  .price .was{color:#94a3b8;text-decoration:line-through}
  .badges{display:flex;gap:6px;flex-wrap:wrap;margin:2px 0 6px}
  .badge{font-size:12px;padding:4px 8px;border-radius:999px;border:1px solid var(--line);background:#fff}
  .badge.sale{color:#b91c1c;border-color:#fecaca;background:#fff1f2}
  .badge.new{color:#065f46;border-color:#bbf7d0;background:#ecfdf5}

  /* 套組橫幅（與首頁 CTA/Bundle 一致） */
  .bundle{position:relative;margin:18px 0;background:linear-gradient(135deg,#fff1f2,#fdf2f8 40%,#eef2ff);
          border:1px solid var(--line);border-radius:20px;padding:18px;display:grid;gap:12px}
  @media(min-width:860px){ .bundle{grid-template-columns:1fr auto;align-items:center} }
  .bundle .title{font-size:20px;font-weight:800;margin:0}
  .bundle .desc{color:#64748b;margin:0}
  .bundle .mini{display:flex;gap:8px;align-items:center}
  .bundle .mini img{width:44px;height:60px;border-radius:8px;border:1px solid var(--line);object-fit:cover;box-shadow:0 4px 10px rgba(15,23,42,.06)}
  .bundle .badge{position:absolute;right:12px;top:-10px;background:#fff;border:1px solid var(--line);
                  padding:6px 10px;border-radius:999px;font-size:12px;color:#0f172a;box-shadow:0 6px 16px rgba(15,23,42,.08)}

  /* 快速預覽 Modal */
  .modal{position:fixed;inset:0;display:none;place-items:center;background:rgba(15,23,42,.35);z-index:60;padding:20px}
  .modal.open{display:grid}
  .modal .box{max-width:880px;width:100%;display:grid;grid-template-columns:1fr 1fr;gap:16px;background:#fff;border-radius:18px;border:1px solid var(--line);padding:16px}
  @media (max-width:860px){ .modal .box{grid-template-columns:1fr} }
  .modal img{width:100%;border-radius:12px;border:1px solid var(--line)}
  .modal h3{margin:0 0 6px}
  .modal .close{position:absolute;right:20px;top:20px;border:none;background:#fff;width:42px;height:42px;border-radius:999px;box-shadow:0 6px 18px rgba(15,23,42,.12);cursor:pointer}

  footer{margin-top:32px;color:#94a3b8;text-align:center}
  .illust{height:120px;border-radius:12px;background:linear-gradient(135deg,#fee2e2,#fce7f3);display:grid;place-items:center;font-size:42px}
  </style>
</head>
<body>

  <div class="promo" role="region" aria-label="促銷訊息">
    8 週戒糖 Reset｜首購 5 折倒數 <span class="count" id="promo-count" aria-live="polite">00:00:00</span>
    <a class="btn" href="https://abbbydreams.gumroad.com/l/susyh" target="_blank" rel="noopener">立即入手</a>
  </div>

  <header class="site" role="banner">
    <div class="wrap nav">
      <button id="m-burger" class="burger" aria-label="開啟導覽" aria-controls="m-menu" aria-expanded="false">
        <span class="bar"></span>
        <span class="bar"></span>
        <span class="bar"></span>
        <span class="label">選單</span>
      </button>

      <div class="brand">
        <div class="logo" aria-hidden="true">QS</div>
        <div>
          <h1 class="title" style="margin:0">戒糖計畫 Quit Sugar</h1>
          <small class="muted">溫柔開始・持續記錄・看見改變</small>
        </div>
      </div>
      <nav class="nav-links" aria-label="主導覽">
        <a href="./">戒糖首頁</a>
        <a href="./element-quiz.html">五行測驗</a>
        <a href="./analyzer.html">食物卡路里分析器</a>
        <a class="active" href="./ebooks.html">電子書商店</a>
        <a class="btn primary" href="./#auth">加入挑戰 / 登入</a>
      </nav>
    </div>
  </header>

  <aside id="m-menu" class="mobile-drawer" aria-hidden="true">
    <header class="m-head">
      <div class="m-brand">QS</div>
      <button id="m-close" class="m-close" aria-label="關閉導覽">✕</button>
    </header>
    <nav id="m-nav" class="m-links" aria-label="行動版導覽"></nav>
  </aside>
  <div id="m-backdrop" class="backdrop" hidden></div>

  <section class="hero">
    <div class="wrap hero-inner">
      <div>
        <span class="eyebrow">商店</span>
        <h1>電子書商店</h1>
        <p>從入門到進階，將「少糖」落地到你的每一天。單本選購或一次入手套組更划算，結帳會帶到 Gumroad 完成下單。</p>
        <div class="actions" style="display:flex;gap:10px;flex-wrap:wrap">
          <a class="btn primary" href="https://abbbydreams.gumroad.com/l/susyh" target="_blank" rel="noopener">立即入手</a>
          <a class="btn" href="#list">瀏覽所有電子書</a>
        </div>
      </div>

      <div class="hero-media" aria-hidden="true">
        <picture>
          <img
            src="./assets/ebook-sugar-reset-cover.jpg"
            alt="8 週戒糖入門電子書的封面展示"
            fetchpriority="high"
            style="max-width:300px;width:70%;height:auto;"
          >
        </picture>
      </div>
    </div>
  </section>

  <section class="wrap">
    <div id="bundle" class="bundle">
      <div>
        <div class="mini">
          <img src="./assets/ebook-sugar-reset-cover.jpg" alt="8 週戒糖入門封面縮圖">
          <img src="./assets/poster-breakfast-20.jpg" alt="低糖早餐 20 道封面縮圖">
          <img src="./assets/poster-eating-out.jpg" alt="外食少糖小抄封面縮圖">
          <img src="./assets/poster-desserts-15.jpg" alt="零糖甜點 15 道封面縮圖">
        </div>
        <h3 class="title">Ebook Bundle｜一次入手最實用的 4 本</h3>
        <p class="desc">「入門 × 早餐 × 外食 × 甜點」完整打包，更容易從生活各面向實踐少糖。</p>
        <div class="actions" style="display:flex;gap:10px;flex-wrap:wrap">
          <a class="btn primary" href="https://abbbydreams.gumroad.com/l/susyh" target="_blank" rel="noopener">前往購買</a>
          <span class="badge">🎁 購買單本，輕鬆開始戒糖</span>
        </div>
      </div>
    </div>
  </section>

  <section class="wrap">
    <div class="toolbar">
      <div class="chips" id="filters">
        <button class="chip active" data-filter="all">全部</button>
        <button class="chip" data-filter="beginner">入門</button>
        <button class="chip" data-filter="breakfast">早餐</button>
        <button class="chip" data-filter="eatingout">外食</button>
        <button class="chip" data-filter="desserts">甜點</button>
      </div>
      <div>
        <label class="muted" for="sort">排序：</label>
        <select id="sort" class="sort">
          <option value="rec">推薦</option>
          <option value="price-asc">價格 低→高</option>
          <option value="price-desc">價格 高→低</option>
          <option value="new">最新上架</option>
        </select>
      </div>
    </div>
  </section>

  <section class="wrap">
    <div id="list" class="grid"></div>
  </section>

  <footer class="wrap" role="contentinfo">
    <p>© 2025 Quit Sugar. 所有價格為新台幣（NT$），為數位商品。下單後你會收到電子郵件與下載連結。</p>
  </footer>

  <div id="modal" class="modal" aria-hidden="true">
    <button class="close" id="modal-close">✕</button>
    <div class="box">
      <div id="modal-cover"></div>
      <div>
        <h3 id="modal-title">—</h3>
        <div class="badges" id="modal-badges"></div>
        <p id="modal-desc" class="muted">—</p>
        <ul id="modal-bullets" class="muted" style="margin:0 0 8px 18px"></ul>
        <div class="price" style="margin:10px 0">
          <div class="now" id="modal-price">NT$—</div>
          <div class="was" id="modal-was" style="display:none">NT$—</div>
        </div>
        <div class="actions" style="display:flex;gap:8px;flex-wrap:wrap">
          <button id="modal-buy" class="btn primary">前往購買</button>
          <button id="modal-sample" class="btn">查看試閱</button>
        </div>
      </div>
    </div>
  </div>

<script>
/* ========= 產品定義 ========= */
const PRODUCTS = [
  { id:'reset8w', name:'8 週戒糖入門（Complete Reset）', price:150, compareAt:300, tags:['beginner','new','sale'],
    cover:{webp:null, jpg:'./assets/ebook-sugar-reset-cover.jpg', alt:'8 週戒糖入門電子書封面'},
    desc:'循序漸進完成 8 週減糖挑戰，穩定能量與心情的入門指南。',
    bullets:['每週行動清單與檢核表','無壓力的替代建議','餐盤與備餐模板'], sample:'#',
    gumroad: 'https://abbbydreams.gumroad.com/l/susyh' }, // Gumroad 連結

  { id:'breakfast20', name:'低糖早餐 20 道', price:220, compareAt:null, tags:['breakfast'],
    cover:{webp:'./assets/poster-breakfast-20.webp', jpg:'./assets/poster-breakfast-20.jpg', alt:'低糖早餐 20 道電子書封面'},
    desc:'好吃、好做、好帶走的清爽早餐，讓一天從輕甜開始。',
    bullets:['5 分鐘完成的快手選項','高蛋白、高纖維搭配','含一週早餐範例菜單'], sample:'#' },

  { id:'eatingout', name:'外食少糖小抄', price:180, compareAt:null, tags:['eatingout'],
    cover:{webp:'./assets/poster-eating-out.webp', jpg:'./assets/poster-eating-out.jpg', alt:'外食少糖小抄電子書封面'},
    desc:'外食也可以少糖：點餐關鍵字、飲料替換與醬汁小技巧。',
    bullets:['各料理系點餐指南','飲料甜度換算與替代','便利商店友善清單'], sample:'#' },

  { id:'desserts15', name:'零糖甜點 15 道', price:250, compareAt:290, tags:['desserts','sale'],
    cover:{webp:'./assets/poster-desserts-15.webp', jpg:'./assets/poster-desserts-15.jpg', alt:'零糖甜點 15 道電子書封面'},
    desc:'滿足儀式感又無負擔的甜點，掌握控糖也保留快樂。',
    bullets:['家用烤箱即可','代糖使用說明','每份營養估算'], sample:'#' }
];

const $ = sel => document.querySelector(sel);
const $all = sel => Array.from(document.querySelectorAll(sel));
const money = n => 'NT$' + (Math.round(n).toLocaleString('zh-TW'));
const state = { filter:'all', sort:'rec' };

/* ========= 渲染產品 ========= */
function badgeSpan(cls, text){ const s = document.createElement('span'); s.className='badge '+(cls||''); s.textContent=text; return s; }
function productCard(p){
  const card = document.createElement('div'); card.className='card product'; card.dataset.tags = p.tags.join(',');
  const pic = document.createElement('picture');
  if(p.cover.webp){ const src = document.createElement('source'); src.srcset = p.cover.webp; src.type='image/webp'; pic.append(src); }
  const img = document.createElement('img'); img.className='cover'; img.src = p.cover.jpg; img.alt = p.cover.alt;
  pic.append(img);
  const title = document.createElement('h4'); title.textContent = p.name;
  const desc = document.createElement('p'); desc.className='muted'; desc.textContent = p.desc;
  const badges = document.createElement('div'); badges.className='badges';
  if(p.tags.includes('sale')) badges.append(badgeSpan('sale','限時優惠'));
  if(p.tags.includes('new')) badges.append(badgeSpan('new','新上架'));
  const price = document.createElement('div'); price.className='price';
  const now = document.createElement('div'); now.className='now'; now.textContent = money(p.price);
  price.append(now);
  if(p.compareAt){ const was = document.createElement('div'); was.className='was'; was.textContent = money(p.compareAt); price.append(was); }
  const actions = document.createElement('div'); actions.className='actions'; actions.style.display='flex'; actions.style.gap='8px'; actions.style.flexWrap='wrap';
  const btnBuy = document.createElement('a');
  btnBuy.className='btn primary';
  btnBuy.textContent='前往購買';
  btnBuy.target='_blank';
  btnBuy.rel='noopener';
  // 檢查是否有 Gumroad 連結，若有則設定，否則停用按鈕
  if(p.gumroad){
    btnBuy.href = p.gumroad;
  } else {
    // 禁用其他產品的購買按鈕，因為目前只銷售《8 週戒糖入門》
    btnBuy.href = '#';
    btnBuy.textContent = '暫不販售';
    btnBuy.disabled = true;
    btnBuy.style.opacity = '.6';
    btnBuy.style.cursor = 'not-allowed';
    btnBuy.classList.add('muted');
    btnBuy.classList.remove('primary');
    btnBuy.onclick = (e) => e.preventDefault();
  }
  const btnView = document.createElement('button'); btnView.className='btn'; btnView.textContent='快速預覽';
  btnView.onclick = ()=> openModal(p.id);
  actions.append(btnBuy, btnView);
  card.append(pic, title, badges, desc, price, actions);
  return card;
}
function renderGrid(){
  const list = $('#list'); list.innerHTML = '';
  let arr = PRODUCTS.slice();
  if(state.filter !== 'all'){ arr = arr.filter(p => p.tags.includes(state.filter)); }
  if(state.sort === 'price-asc') arr.sort((a,b)=>a.price-b.price);
  if(state.sort === 'price-desc') arr.sort((a,b)=>b.price-a.price);
  if(state.sort === 'new') arr.sort((a,b)=>(b.tags.includes('new')?1:0)-(a.tags.includes('new')?1:0));
  arr.forEach(p => list.append(productCard(p)));
}

/* ========= 快速預覽 ========= */
function openModal(id){
  const p = PRODUCTS.find(x=>x.id===id); if(!p) return;
  const box = $('#modal'); box.classList.add('open'); box.setAttribute('aria-hidden','false');
  const coverWrap = $('#modal-cover'); coverWrap.innerHTML='';
  const pic = document.createElement('picture');
  if(p.cover.webp){ const s = document.createElement('source'); s.srcset = p.cover.webp; s.type='image/webp'; pic.append(s); }
  const img = document.createElement('img'); img.src = p.cover.jpg; img.alt = p.cover.alt;
  pic.append(img); coverWrap.append(pic);
  $('#modal-title').textContent = p.name;
  $('#modal-desc').textContent = p.desc;
  const badges = $('#modal-badges'); badges.innerHTML='';
  if(p.tags.includes('sale')) badges.append(badgeSpan('sale','限時優惠'));
  if(p.tags.includes('new')) badges.append(badgeSpan('new','新上架'));
  $('#modal-price').textContent = money(p.price);
  if(p.compareAt){ $('#modal-was').style.display='inline'; $('#modal-was').textContent = money(p.compareAt); } else { $('#modal-was').style.display='none'; }
  const ul = $('#modal-bullets'); ul.innerHTML='';
  (p.bullets||[]).forEach(t=>{ const li=document.createElement('li'); li.textContent=t; ul.append(li); });
  const buyBtn = $('#modal-buy');
  if(p.gumroad){
    buyBtn.textContent = '前往購買';
    buyBtn.href = p.gumroad;
    buyBtn.disabled = false;
    buyBtn.classList.remove('muted');
    buyBtn.classList.add('primary');
  } else {
    buyBtn.textContent = '暫不販售';
    buyBtn.href = '#';
    buyBtn.disabled = true;
    buyBtn.classList.add('muted');
    buyBtn.classList.remove('primary');
  }
  buyBtn.target = '_blank';
  buyBtn.rel = 'noopener';
  $('#modal-sample').onclick = ()=> window.open(p.sample || '#','_blank','noopener');
}
function closeModal(){ const box = $('#modal'); box.classList.remove('open'); box.setAttribute('aria-hidden','true'); }

/* ========= 事件綁定 ========= */
window.addEventListener('DOMContentLoaded', ()=>{
  renderGrid();

  // 倒數（促銷條）：預設 48 小時
  (function promoCountdown(){
    const el = document.getElementById('promo-count'); if(!el) return;
    const end = Date.now() + 1000*60*60*48;
    const tick = () => {
      const left = Math.max(0, end - Date.now());
      const h = String(Math.floor(left/3600000)).padStart(2,'0');
      const m = String(Math.floor((left%3600000)/60000)).padStart(2,'0');
      const s = String(Math.floor((left%60000)/1000)).padStart(2,'0');
      el.textContent = `${h}:${m}:${s}`;
    };
    tick(); setInterval(tick, 1000);
  })();

  // Filter / Sort
  Array.from(document.querySelectorAll('#filters .chip')).forEach(ch=>{
    ch.addEventListener('click', ()=>{
      Array.from(document.querySelectorAll('#filters .chip')).forEach(c=>c.classList.remove('active'));
      ch.classList.add('active'); state.filter = ch.dataset.filter; renderGrid();
    });
  });
  document.getElementById('sort').addEventListener('change', (e)=>{ state.sort = e.target.value; renderGrid(); });

  // Modal 關閉
  document.getElementById('modal-close').addEventListener('click', closeModal);
});

/* ========= 小工具：toast ========= */
function toast(msg){
  const n = document.createElement('div');
  n.textContent = msg;
  n.style.cssText = 'position:fixed;left:50%;bottom:24px;transform:translateX(-50%);background:#111827;color:#fff;padding:10px 14px;border-radius:12px;box-shadow:0 10px 26px rgba(0,0,0,.2);z-index:70;opacity:0;transition:opacity .2s, transform .2s';
  document.body.appendChild(n);
  requestAnimationFrame(()=>{ n.style.opacity='1'; n.style.transform='translateX(-50%) translateY(-4px)'; });
  setTimeout(()=>{ n.style.opacity='0'; n.style.transform='translateX(-50%) translateY(0)'; setTimeout(()=>n.remove(),200); }, 1400);
}

/* ========= 圖片 fallback（避免破圖） ========= */
(function () {
  function fallback(node, emoji) {
    var ph = document.createElement('div');
    ph.className = 'illust';
    ph.textContent = emoji || '📘';
    node.replaceWith(ph);
  }
  document.addEventListener('error', function(e){
    const img = e.target;
    if(img.tagName === 'IMG'){
      if (img.closest('.product')) return fallback(img, '📘');
      if (img.closest('.bundle')) return fallback(img, '🎁');
      fallback(img, '🖼️');
    }
  }, true);
})();

/* ========= 漢堡抽屜導覽 JS ========= */
(function(){
  var desktopNav = document.querySelector('.nav-links');
  var mobileNav  = document.getElementById('m-nav');
  var burger     = document.getElementById('m-burger');
  var drawer     = document.getElementById('m-menu');
  var backdrop   = document.getElementById('m-backdrop');
  var closeBtn   = document.getElementById('m-close');
  if (!desktopNav || !mobileNav || !burger || !drawer || !backdrop || !closeBtn) return;

  // 複製桌面導覽內容到行動抽屜
  mobileNav.innerHTML = desktopNav.innerHTML;

  function openDrawer(){
    drawer.classList.add('open');
    backdrop.hidden = false;
    burger.setAttribute('aria-expanded','true');
    document.body.style.overflow = 'hidden';
  }
  function closeDrawer(){
    drawer.classList.remove('open');
    backdrop.hidden = true;
    burger.setAttribute('aria-expanded','false');
    document.body.style.overflow = '';
  }
  burger.addEventListener('click', openDrawer);
  closeBtn.addEventListener('click', closeDrawer);
  backdrop.addEventListener('click', closeDrawer);
  document.addEventListener('keydown', function(e){ if(e.key === 'Escape') closeDrawer(); });
  mobileNav.addEventListener('click', function(e){ if (e.target.tagName === 'A') closeDrawer(); });
})();
</script>
</body>
</html>