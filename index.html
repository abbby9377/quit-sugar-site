<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>æˆ’ç³–è¨ˆç•«ï½œQuit Sugar</title>
  <meta name="description" content="è¼•é¬†é–‹å§‹ã€æŒçºŒè¨˜éŒ„ã€çœ‹è¦‹æ”¹è®Šï¼šç™»å…¥è¿½è¹¤é€£å‹ã€å¥åº·è¡Œå‹•æ¸…å–®ã€æ¯é€±æŒ‘æˆ°èˆ‡æ¿€å‹µèªå¥ï¼Œé‚„æœ‰é£Ÿç‰©å¡è·¯é‡Œåˆ†æå™¨ã€äº”è¡Œé¦™æ°´èˆ‡é›»å­æ›¸å•†åº—ã€‚"/>
  <meta name="theme-color" content="#f472b6" />

  <!-- å­—é«” -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;600;700;800&family=Noto+Serif+TC:wght@700&display=swap" rel="stylesheet">

  <style>
/* === ä½ åŸæœ¬çš„ã€ŒResponsive ä¸»å°è¦½ã€è¨­å®šï¼ˆä¿ç•™ï¼‰ === */
.nav { flex-wrap: wrap; }
.nav-links {
  display: flex;
  align-items: center;
  gap: 16px;
  flex-wrap: wrap;
  max-width: 100%;
}
.nav-links a,
.nav-links .btn {
  font-size: clamp(13px, 3.4vw, 16px);
}
@media (max-width: 720px){
  .brand .logo{ width:36px; height:36px; border-radius:12px; }
  .brand .title{ font-size:18px; }
  .nav-links{
    gap:10px;
    flex: 1 1 100%;
    order: 2;
    overflow-x: auto;
    white-space: nowrap;
    padding-bottom: 6px;
    margin-top: 6px;
  }
  .nav-links a{
    padding: 6px 10px;
    border: 1px solid var(--line);
    border-radius: 999px;
    background:#fff;
  }
  .nav-links .btn{
    padding: 8px 12px;
  }
}

/* === é¡å¤–æ–°å¢ï¼šæ¼¢å ¡éˆ•ï¼‹æŠ½å±œå°è¦½æ¨£å¼ === */
.burger{
  display:none; width:40px; height:40px; border:1px solid #e5e7eb;
  border-radius:10px; background:#fff; cursor:pointer;
  align-items:center; justify-content:center;
}
.burger span{display:block;width:20px;height:2px;background:#0b1220;margin:3px 0;border-radius:2px}
.mobile-drawer{
  position:fixed; inset:0 auto 0 0; width:86vw; max-width:320px; background:#fff;
  border-right:1px solid #e5e7eb; box-shadow:8px 0 30px rgba(15,23,42,.18);
  transform:translateX(-100%); transition:transform .25s ease; z-index:60;
  display:flex; flex-direction:column;
}
.mobile-drawer.open{ transform:none; }
.m-head{display:flex; justify-content:space-between; align-items:center; padding:14px; border-bottom:1px solid #e5e7eb}
.m-brand{width:36px;height:36px;border-radius:12px;display:grid;place-items:center;
  background:linear-gradient(135deg,#f472b6,#ec4899); color:#fff; font-weight:900}
.m-close{border:none;background:#fff;width:36px;height:36px;border-radius:10px;cursor:pointer}
.m-links{display:flex; flex-direction:column; gap:8px; padding:14px}
.m-links a{display:block; padding:12px 12px; border:1px solid #e5e7eb; border-radius:12px; background:#fff; color:#0b1220; text-decoration:none}
.m-links a.active{border-color:#d946ef;background:#fdf4ff}
.m-links .btn{justify-content:center}
.backdrop{ position:fixed; inset:0; background:rgba(0,0,0,.38); z-index:55; }
.backdrop[hidden]{ display:none }
@media (max-width: 860px){
  .burger{ display:inline-flex; }
  .nav .nav-links{ display:none; } /* æ‰‹æ©Ÿä»¥æŠ½å±œç‚ºä¸»ï¼Œéš±è—æ¡Œæ©Ÿå°è¦½ */
}

/* === ä½ åŸæœ¬çš„ä¸»é¡Œè‰²èˆ‡å…ƒä»¶æ¨£å¼ï¼ˆä¿ç•™ï¼‰ === */
:root{
  --bg:#ffffff; --panel:#ffffff; --ink:#0b1220; --muted:#475569; --line:#e5e7eb;
  --brand:#ec4899; --brand-2:#f472b6; --brand-3:#fb7185;
  --accent:#fdf2f8; --promo:#fff1f5; --ok:#16a34a; --danger:#ef4444;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;background:var(--bg);color:var(--ink);
  font-family:'Noto Sans TC',system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
  -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
}
img{max-width:100%;display:block}
a{color:#2563eb;text-decoration:none}
a:hover{text-decoration:underline}
.wrap{max-width:1120px;margin:0 auto;padding:0 20px 80px}

/* ä¿ƒéŠ·æ¢ */
.promo{background:var(--promo);border-bottom:1px solid var(--line);text-align:center;padding:10px 12px;color:#7a294a;font-weight:700}
.promo .btn{margin-left:10px}
.promo .count{font-weight:800;margin-left:8px;color:#be185d}

/* Header */
header.site{position:sticky;top:0;background:#fff;z-index:20;border-bottom:1px solid var(--line)}
.nav{display:flex;align-items:center;justify-content:space-between;gap:16px;padding:14px 0}
.brand{display:flex;gap:12px;align-items:center}
.logo{width:44px;height:44px;border-radius:14px;background:linear-gradient(135deg,var(--brand-2),var(--brand));display:grid;place-items:center;color:#fff;font-weight:900}
.title{margin:0;font-size:22px;letter-spacing:.3px}
.nav-links{display:flex;gap:16px;align-items:center}
.nav-links a.active{font-weight:800;color:#1d4ed8}

/* Buttons */
.btn{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--line);padding:12px 16px;border-radius:999px;background:#fff;color:var(--ink);cursor:pointer;white-space:nowrap}
.btn.primary{background:linear-gradient(135deg,var(--brand-2),var(--brand));color:#fff;border:none;font-weight:800}
.btn.ghost{background:transparent}
.btn.danger{background:linear-gradient(135deg,#ef4444,#b91c1c);border:none;color:#fff}
.btn[disabled]{opacity:.6;cursor:not-allowed}

/* Hero */
.hero{background:linear-gradient(180deg,#fff,#fff 34%,#fdf2f8 34%,#fdf2f8);border-bottom:1px solid var(--line)}
.hero-inner{display:grid;gap:26px;align-items:center;padding:34px 0}
.eyebrow{display:inline-block;color:#a21caf;background:#fce7f3;border:1px solid #fbcfe8;padding:4px 10px;border-radius:999px;font-weight:700;font-size:12px;margin-bottom:8px}
.hero h1{font-family:"Noto Serif TC",serif;font-weight:700;font-size:34px;line-height:1.25;margin:0 0 10px;letter-spacing:.2px}
.hero p{color:#475569;margin:0 0 16px;max-width:60ch}
.hero-media{justify-self:end}
.hero-media img{width:min(260px,100%);height:auto;border-radius:24px;border:1px solid var(--line);box-shadow:0 20px 60px rgba(236,72,153,.15)}
.subnav{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px}
.chip{padding:8px 12px;border:1px solid var(--line);border-radius:999px;background:#fff}
.chip a{color:#334155;text-decoration:none}

/* Features */
.section-title{font-size:18px;margin:22px 0 10px}
.features{display:grid;gap:14px;}
.feature{background:#fff;border:1px solid var(--line);border-radius:16px;padding:14px}
.feature .feat-photo{width:100%;height:140px;border-radius:12px;object-fit:cover;border:1px solid var(--line)}
.feature h4{margin:8px 0 6px;font-size:15px}
.icon{width:34px;height:34px;border-radius:10px;display:grid;place-items:center;margin-top:6px;background:linear-gradient(135deg,#fde68a,#fca5a5)}

/* Steps */
.steps{display:grid;gap:12px;margin:2px 0 20px;}
.step{background:#fff;border:1px solid var(--line);border-radius:16px;padding:16px;display:grid;gap:12px}
.step .thumb{width:100%;height:180px;border-radius:12px;object-fit:cover;border:1px solid var(--line)}
.step .num{font-weight:800;color:var(--brand)}

/* Carousel */
.carousel{position:relative;margin:2px 0 18px}
.car-track{display:flex;gap:12px;overflow-x:auto;scroll-snap-type:x mandatory;padding-bottom:6px}
.car-track::-webkit-scrollbar{height:8px}
.car-track::-webkit-scrollbar-thumb{background:#e5e7eb;border-radius:999px}
.recipe.cardish{scroll-snap-align:center;min-width:88%;background:#fff;border:1px solid var(--line);border-radius:16px;padding:14px}
.photo{width:100%;height:160px;border-radius:12px;object-fit:cover;margin-bottom:10px;border:1px solid var(--line)}
.car-btn{position:absolute;top:38%;transform:translateY(-50%);border:none;width:42px;height:42px;border-radius:999px;background:#fff;box-shadow:0 6px 16px rgba(15,23,42,.08);cursor:pointer;z-index:2}
.car-btn.prev{left:-10px}.car-btn.next{right:-10px}

/* Bundle CTA */
.bundle{position:relative;display:grid;gap:10px;align-items:center;
        border:1px solid var(--line);border-radius:20px;padding:18px;margin:14px 0 18px;
        background:linear-gradient(135deg,#fff1f2,#fdf2f8 40%,#eef2ff)}
.bundle .title{font-size:20px;font-weight:800;color:#0f172a;margin:0}
.bundle .desc{color:#64748b;margin:0}
.bundle .actions{display:flex;gap:10px;flex-wrap:wrap}
.bundle .badge{position:absolute;right:12px;top:-10px;background:#fff;border:1px solid var(--line);padding:6px 10px;border-radius:999px;font-size:12px;color:#0f172a;box-shadow:0 6px 16px rgba(15,23,42,.08)}
.bundle .mini{display:flex;gap:8px;align-items:center}
.bundle .mini img{width:44px;height:60px;border-radius:8px;border:1px solid var(--line);object-fit:cover;box-shadow:0 4px 10px rgba(15,23,42,.06)}

/* æ¨è–¦é›»å­æ›¸ */
.recs{margin:10px auto 24px}
.recs .grid{display:grid;gap:14px;}
.poster{background:#fff;border:1px solid var(--line);border-radius:16px;padding:12px;box-shadow:0 6px 20px rgba(236,72,153,.08);text-align:center}
.poster img{width:100%;border-radius:12px;border:1px solid var(--line)}
.poster .meta{font-size:12px;color:#64748b;margin-top:6px}
.poster .cta{margin-top:8px}
.poster .cta .btn{width:100%;justify-content:center}

/* Testimonials */
.testimonials{display:grid;gap:12px;margin:4px 0 20px;}
.quote{border-left:3px solid var(--brand);background:#fff;border:1px solid var(--line);padding:12px;border-radius:10px;display:grid;grid-template-columns:auto 1fr;gap:10px;align-items:start}
.quote img.avatar{width:44px;height:44px;border-radius:999px;object-fit:cover;border:1px solid var(--line)}
.quote footer{margin-top:4px;color:#64748b}

/* FAQ */
details.faq{border:1px solid var(--line);border-radius:12px;padding:10px;background:#fff}
details.faq + details.faq{margin-top:10px}
details.faq summary{cursor:pointer;font-weight:600}

/* Auth + Streaks + Todo */
.grid-2{display:grid;gap:16px;}
.card{background:#fff;border:1px solid var(--line);border-radius:18px;padding:18px;box-shadow:0 6px 20px rgba(236,72,153,.08)}
.kicker{display:inline-block;padding:4px 10px;border-radius:999px;background:#fff;border:1px solid var(--line);color: var(--brand);font-size:12px;font-weight:700}
.row{display:grid;gap:10px}
.row2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
input{width:100%;background:#fff;border:1px solid #d1d5db;padding:10px 12px;border-radius:12px;color:var(--ink);font:inherit}
.stat{display:flex;gap:14px;align-items:center}
.stat .num{font-size:28px;font-weight:800}
.muted{color:var(--muted)}
.error{border-left:3px solid var(--danger);padding:10px 12px;background:#fff5f5;border-radius:12px}

/* æ¯é€±æŒ‘æˆ°é€²åº¦æ¢ */
.progress-wrap{margin-top:10px}
.progress-bar{height:10px;background:#f1f5f9;border-radius:999px;overflow:hidden;border:1px solid var(--line)}
.progress-bar span{display:block;height:100%;width:0%;background:linear-gradient(135deg,var(--brand-2),var(--brand-3))}

/* äº”è¡Œé¦™æ°´ */
.perfume{margin:20px 0}
.perf-grid{display:grid;gap:12px;}
.perf-card{background:#fff;border:1px solid var(--line);border-radius:16px;padding:14px;text-align:center}
.perf-card .el{font-weight:800;margin-bottom:6px}
.pill{display:inline-block;padding:4px 8px;border:1px solid var(--line);border-radius:999px;background:#fff;font-size:12px;color:#0f172a;margin:2px}

/* å¾½ç«  */
.badges{display:flex;gap:10px;margin-top:10px;flex-wrap:wrap}
.badge{display:flex;align-items:center;gap:6px;border:1px solid var(--line);border-radius:999px;padding:6px 10px;background:#f8fafc;color:#64748b}
.badge.unlocked{background:#ecfeff;border-color:#67e8f9;color:#0e7490;font-weight:700}

/* æ¯æ—¥é©šå–œå¡ */
.surprise{margin-top:14px;padding:14px;border:1px dashed #f9a8d4;border-radius:14px;background:#fff0f6}
.surprise .title{font-weight:800;margin-bottom:6px}

/* å‹•ç•«æ¸›é‡åå¥½ */
@media (prefers-reduced-motion: reduce){ .car-track{ scroll-behavior:auto; } }

/* --- ä½ çš„ RWD æ®µè½ï¼ˆä¿ç•™ï¼Œç•¥å¾®è£œå¼· Hero åœ–ï¼‰ --- */
.hero-inner{ grid-template-columns: 1fr; }
.features{ grid-template-columns: 1fr; }
.steps{ grid-template-columns: 1fr; }
.perf-grid{ grid-template-columns: 1fr; }
.bundle{ grid-template-columns: 1fr; }
.testimonials{ grid-template-columns: 1fr; }
.grid-2{ grid-template-columns: 1fr; }
.recs .grid{ grid-template-columns: 1fr; }
.carousel .recipe.cardish{ min-width: 88%; }
.hero-media img { width: min(260px, 100%); }

@media (min-width: 640px) {
  .features{ grid-template-columns: repeat(2, 1fr); }
  .perf-grid{ grid-template-columns: repeat(2, 1fr); }
  .recs .grid{ grid-template-columns: repeat(2, 1fr); }
  .carousel .recipe.cardish{ min-width: 48%; }
  .hero-media img { width: min(320px, 100%); }
}
@media (min-width: 768px) {
  .hero-inner{ grid-template-columns: 1.1fr 1fr; }
  .steps{ grid-template-columns: repeat(2, 1fr); }
  .carousel .recipe.cardish{ min-width: 42%; }
  .hero-media img { width: min(400px, 100%); }
}
@media(min-width:860px){
  .features{grid-template-columns:repeat(4,1fr)}
  .testimonials{grid-template-columns:repeat(2,1fr)}
  .bundle{grid-template-columns:1fr auto}
  .carousel .recipe.cardish{min-width:42%}
  .hero-media img { width: min(520px, 100%); }
}
@media(min-width:900px){
  .steps{grid-template-columns:repeat(3,1fr)}
  .perf-grid{grid-template-columns:repeat(5,1fr)}
  .recs .grid{grid-template-columns:repeat(4,1fr)}
}
@media(min-width:960px){
  .grid-2{grid-template-columns:1.1fr 1fr}
}
  </style>

  <!-- å…¨åŸŸéŒ¯èª¤é¡¯ç¤º -->
  <script>
    window.onerror = function(msg, src, line, col) {
      var box = document.getElementById('auth-error');
      if (box) { box.style.display = 'block'; box.textContent = 'å‰ç«¯éŒ¯èª¤ï¼š ' + msg + ' (' + src + ':' + line + ':' + col + ')'; }
    };
  </script>

  <!-- Supabase SDKï¼šä¸» CDN + å¾Œå‚™ -->
  <script>
    (function loadSupabaseSDK() {
      var primary = "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.4/dist/umd/supabase.min.js";
      var fallback = "https://unpkg.com/@supabase/supabase-js@2.45.4/dist/umd/supabase.min.js";
      function append(src) {
        var s = document.createElement('script');
        s.src = src; s.defer = true;
        s.onload = function(){ window.__supabaseReady = true; };
        s.onerror = function(){
          if (src === primary) {
            append(fallback);
          } else {
            var el = document.getElementById('auth-error');
            if (el) { el.style.display = 'block'; el.textContent = 'è¼‰å…¥ Supabase SDK å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚'; }
          }
        };
        document.head.appendChild(s);
      }
      append(primary);
    })();
  </script>
</head>
<body>

  <!-- ä¿ƒéŠ·æ¢ï¼ˆå«å€’æ•¸ï¼‰ -->
  <div class="promo" role="region" aria-label="ä¿ƒéŠ·è¨Šæ¯">
    8 é€±æˆ’ç³– Resetï½œé¦–è³¼ 5 æŠ˜å€’æ•¸ <span class="count" id="promo-count" aria-live="polite">00:00:00</span>
    <a class="btn" href="#bundle" aria-label="ç«‹å³åŠ å…¥">ç«‹å³åŠ å…¥</a>
  </div>

  <!-- Header -->
  <header class="site" role="banner">
    <div class="wrap nav">
      <!-- æ–°å¢ï¼šè¡Œå‹•ç‰ˆæ¼¢å ¡éˆ• -->
      <button id="m-burger" class="burger" aria-label="é–‹å•Ÿå°è¦½" aria-controls="m-menu" aria-expanded="false">
        <span></span><span></span><span></span>
      </button>

      <div class="brand">
        <div class="logo" aria-hidden="true">QS</div>
        <div>
          <h1 class="title" style="margin:0">æˆ’ç³–è¨ˆç•« Quit Sugar</h1>
          <small class="muted">æº«æŸ”é–‹å§‹ãƒ»æŒçºŒè¨˜éŒ„ãƒ»çœ‹è¦‹æ”¹è®Š</small>
        </div>
      </div>
      <nav class="nav-links" aria-label="ä¸»å°è¦½">
        <a class="active" href="./">æˆ’ç³–é¦–é </a>
        <a href="./element-quiz.html">äº”è¡Œæ¸¬é©—</a>
        <a href="./analyzer.html">é£Ÿç‰©å¡è·¯é‡Œåˆ†æå™¨</a>
        <a href="./ebooks.html">é›»å­æ›¸å•†åº—</a>
        <a class="btn primary" href="#auth">åŠ å…¥æŒ‘æˆ° / ç™»å…¥</a>
      </nav>
    </div>
  </header>

  <!-- æ–°å¢ï¼šMobile æŠ½å±œå°è¦½èˆ‡é®ç½©ï¼ˆæ”¾åœ¨ header å¾Œï¼‰ -->
  <aside id="m-menu" class="mobile-drawer" aria-hidden="true">
    <header class="m-head">
      <div class="m-brand">QS</div>
      <button id="m-close" class="m-close" aria-label="é—œé–‰å°è¦½">âœ•</button>
    </header>
    <nav id="m-nav" class="m-links" aria-label="è¡Œå‹•ç‰ˆå°è¦½"></nav>
  </aside>
  <div id="m-backdrop" class="backdrop" hidden></div>

  <!-- Hero -->
  <section class="hero">
    <div class="wrap hero-inner">
      <div>
        <span class="eyebrow">å¾ä»Šå¤©é–‹å§‹</span>
        <h1>ä½ çš„è¼•ç”œç”Ÿæ´»ï¼Œå¾ 1% æ”¹è®Šé–‹å§‹</h1>
        <p>çµ¦è‡ªå·± 8 é€±ï¼Œæ›ä¾†æ›´ç©©å®šçš„èƒ½é‡èˆ‡å¥½å¿ƒæƒ…ï¼šæ¯æ—¥ 1 å€‹å°è¡Œå‹•ã€æ¯é€±å¾®èª¿ã€‚</p>
        <div class="actions" style="display:flex;gap:10px;flex-wrap:wrap">
          <a class="btn primary" href="#auth">åŠ å…¥æŒ‘æˆ° / ç™»å…¥</a>
          <a class="btn" href="./element-quiz.html">åš 60 ç§’äº”è¡Œæ¸¬é©—</a>
          <a class="btn" href="./ebooks.html">é€›é€›é›»å­æ›¸å•†åº—</a>
        </div>
        <div class="subnav">
          <span class="chip"><a href="#why">ç‚ºä»€éº¼æœ‰æ•ˆ</a></span>
          <span class="chip"><a href="#steps">ä¸‰æ­¥é©Ÿé–‹å§‹</a></span>
          <span class="chip"><a href="#perfume">äº”è¡Œé¦™æ°´</a></span>
          <span class="chip"><a href="#recipes">é£Ÿè­œéˆæ„Ÿ</a></span>
          <span class="chip"><a href="#bundle">Ebook Bundle</a></span>
          <span class="chip"><a href="#stories">æˆåŠŸæ•…äº‹</a></span>
          <span class="chip"><a href="#faq">FAQ</a></span>
        </div>
      </div>

      <div class="hero-media" aria-hidden="true">
        <picture>
          <source srcset="./assets/feature-mind-body.webp" type="image/webp">
          <img
            src="./assets/feature-mind-body.jpg"
            alt="åœ¨ç‘œä¼½å¢Šä¸Šå†¥æƒ³çš„å¥³æ€§ï¼Œå±•ç¾å°ˆæ³¨èˆ‡èº«å¿ƒå¹³è¡¡"
            fetchpriority="high"
            style="max-width:300px;width:70%;height:auto;"
          >
        </picture>
      </div>
    </div>
  </section>

  <main class="wrap" role="main">
    <!-- å››å¤§é‡é» -->
    <h3 id="why" class="section-title">ç‚ºä»€éº¼é€™å€‹æ–¹æ³•æ›´æº«æŸ”ã€ä¹Ÿæ›´æœ‰æ•ˆï¼Ÿ</h3>
    <div class="features">
      <div class="feature">
        <picture><source srcset="./assets/feature-warm-approach.webp" type="image/webp"><img class="feat-photo" src="./assets/feature-warm-approach.jpg" alt="è¦ªå’ŒåŠ›åè¶³çš„å¥³æ€§å¾®ç¬‘è‚–åƒ" loading="lazy" decoding="async"></picture>
        <div class="icon">ğŸ’—</div>
        <h4>ä¸å¿…å…¨æˆ–ç„¡</h4>
        <p class="muted">å¾ªåºæ¼¸é€²çš„ä½ç³–ç¯€å¥ï¼Œæ­é…æ›¿ä»£é¸æ“‡ï¼Œå£“åŠ›æ›´å°ã€æˆåŠŸç‡æ›´é«˜ã€‚</p>
      </div>
      <div class="feature">
        <picture><source srcset="./assets/feature-tasty-low-sugar.webp" type="image/webp"><img class="feat-photo" src="./assets/feature-tasty-low-sugar.jpg" alt="ä½ç³–æ—©é¤ç¢—èˆ‡è“æœå·§å…‹åŠ›" loading="lazy" decoding="async"></picture>
        <div class="icon">ğŸ¥—</div>
        <h4>å¥½åƒä¹Ÿèƒ½å°‘ç³–</h4>
        <p class="muted">ç°¡å–®æ–™ç†éˆæ„Ÿèˆ‡è¶…å¸‚é¸ç‰©å»ºè­°ï¼Œæ—¥å¸¸å°±èƒ½åšåˆ°ã€‚</p>
      </div>
      <div class="feature">
        <picture><source srcset="./assets/feature-mind-body.webp" type="image/webp"><img class="feat-photo" src="./assets/feature-mind-body.jpg" alt="é‹å‹•èˆ‡å†¥æƒ³çš„ç”Ÿæ´»ç‰‡æ®µ" loading="lazy" decoding="async"></picture>
        <div class="icon">ğŸ§˜â€â™€ï¸</div>
        <h4>èº«å¿ƒä¸€èµ·ç…§é¡§</h4>
        <p class="muted">çµåˆç¡çœ ã€å£“åŠ›èˆ‡ç°¡æ˜“é‹å‹•ï¼Œè®“æ¸´æœ›æ›´å¥½ç®¡ç†ã€‚</p>
      </div>
      <div class="feature">
        <picture><source srcset="./assets/feature-progress.webp" type="image/webp"><img class="feat-photo" src="./assets/feature-progress.jpg" alt="å·§å…‹åŠ›é…è“æœçš„ä»½é‡æ§ç®¡" loading="lazy" decoding="async"></picture>
        <div class="icon">ğŸ“ˆ</div>
        <h4>çœ‹å¾—è¦‹çš„æˆå°±</h4>
        <p class="muted">ç”¨ã€Œé€£å‹å¤©æ•¸ã€èˆ‡ã€Œæœ€é•·ç´€éŒ„ã€è¿½è¹¤é€²æ­¥ï¼Œè¶…æœ‰æˆå°±æ„Ÿã€‚</p>
      </div>
    </div>

    <!-- ä¸‰æ­¥é©Ÿ -->
    <h3 id="steps" class="section-title">ä¸‰æ­¥é©Ÿé–‹å§‹ï¼ˆä»Šå¤©å°±èƒ½åšï¼‰</h3>
    <div class="steps">
      <div class="step">
        <div><div class="num">Step 1</div><strong>å»ºç«‹å°ç›®æ¨™</strong><p class="muted">é¸æ“‡èµ·å§‹æ—¥èˆ‡ 1% æ”¹è®Šï¼Œé‚å‡ºç¬¬ä¸€æ­¥ã€‚</p></div>
        <picture><source srcset="./assets/step1-goal.webp" type="image/webp"><img class="thumb" src="./assets/step1-goal.jpg" alt="è¦åŠƒèµ·é»èˆ‡ç›®æ¨™çš„ç­†è¨˜èˆ‡æ‰‹å¯«ç•«é¢" loading="lazy" decoding="async"></picture>
      </div>
      <div class="step">
        <div><div class="num">Step 2</div><strong>æ¯å¤© 1 å€‹å°è¡Œå‹•</strong><p class="muted">ä¾‹å¦‚ï¼šæ™šé¤ä¸å–å«ç³–é£²æ–™ï¼Œæˆ–æ•£æ­¥ 20 åˆ†é˜ã€‚</p></div>
        <picture><source srcset="./assets/step2-action.webp" type="image/webp"><img class="thumb" src="./assets/step2-action.jpg" alt="æ—¥å¸¸å¯è¡Œçš„å°è¡Œå‹•èˆ‡å¥åº·é£²é£Ÿ" loading="lazy" decoding="async"></picture>
      </div>
      <div class="step">
        <div><div class="num">Step 3</div><strong>è¨˜éŒ„æˆå°±ã€æ¯é€±å¾®èª¿</strong><p class="muted">ç”¨é€£å‹å¤©æ•¸ä¿æŒå‹•åŠ›ï¼Œä¾é«”æ„ŸæŒçºŒå¾®èª¿ã€‚</p></div>
        <picture><source srcset="./assets/step3-track.webp" type="image/webp"><img class="thumb" src="./assets/step3-track.jpg" alt="Habit tracker èˆ‡é€£å‹ä»‹é¢" loading="lazy" decoding="async"></picture>
      </div>
    </div>

    <!-- äº”è¡Œé¦™æ°´ï¼ˆåƒ…å±•ç¤ºï¼‰ -->
    <section id="perfume" class="perfume">
      <h3 class="section-title">äº”è¡Œé¦™æ°´ï¼ˆBetaï¼‰</h3>
      <p class="muted">ç”¨äº”è¡Œæ‰¾åˆ°ä½ çš„å°ˆå±¬é¦™ï¼šå…ˆåš <a href="./element-quiz.html">60 ç§’æ¸¬é©—</a>ï¼Œå†é¸ä¸»/å‰¯å…ƒç´ ã€‚</p>
      <div class="perf-grid">
        <div class="perf-card"><div class="el">æœ¨ï½œæ¸…æ–°è‰æœ¨</div><div><span class="pill">ç¶ æ„</span><span class="pill">è‰æœ¬</span><span class="pill">æ™¨å…‰</span></div></div>
        <div class="perf-card"><div class="el">ç«ï½œæŸ‘æ©˜è¾›é¦™</div><div><span class="pill">æŸ‘æ©˜</span><span class="pill">è¾›é¦™</span><span class="pill">æ´»åŠ›</span></div></div>
        <div class="perf-card"><div class="el">åœŸï½œé¦™è‰æš–èª¿</div><div><span class="pill">é¦™è‰</span><span class="pill">å®‰å®š</span><span class="pill">å¥¶é¦™</span></div></div>
        <div class="perf-card"><div class="el">é‡‘ï½œæ¸…é€èŠ±é¦™</div><div><span class="pill">èŠ±é¦™</span><span class="pill">ä¿è½</span><span class="pill">é€šé€</span></div></div>
        <div class="perf-card"><div class="el">æ°´ï½œæµ·é¹½éºé¦™</div><div><span class="pill">æµ·é¹½</span><span class="pill">æ”¾é¬†</span><span class="pill">ç™½éºé¦™</span></div></div>
      </div>
    </section>

    <!-- é£Ÿè­œéˆæ„Ÿ -->
    <h3 id="recipes" class="section-title">æœ¬é€±é£Ÿè­œéˆæ„Ÿï¼ˆå·¦å³æ»‘å‹•ï¼‰</h3>
    <div class="carousel">
      <button class="car-btn prev" id="car-prev" aria-label="ä¸Šä¸€å€‹">â€¹</button>
      <div class="car-track" id="car-track">
        <div class="recipe cardish">
          <picture><source srcset="./assets/feature-tasty-low-sugar.webp" type="image/webp"><img class="photo" src="./assets/feature-tasty-low-sugar.jpg" alt="ä½ç³–æ—©é¤ç¢—ï¼šç‡•éº¥ã€å …æœèˆ‡æ°´æœ" loading="lazy" decoding="async"></picture>
          <strong>æš–èƒƒç‡•éº¥ç¢—</strong>
          <p class="muted">ç”œå‘³ä¾†è‡ªé¦™è•‰èˆ‡è‚‰æ¡‚ï¼Œæ—©é¤ä¹Ÿèƒ½è¼•ç”œã€‚</p>
          <a class="btn" href="./analyzer.html">ç”¨åˆ†æå™¨ä¼°å¡è·¯é‡Œ</a>
        </div>
        <div class="recipe cardish">
          <picture><source srcset="./assets/feature-progress.webp" type="image/webp"><img class="photo" src="./assets/feature-progress.jpg" alt="70% é»‘å·§å…‹åŠ›æ­é…è“æœ" loading="lazy" decoding="async"></picture>
          <strong>70% å¯å¯å°é»</strong>
          <p class="muted">æƒ³åƒç”œæ™‚çš„æ›¿ä»£é¸æ“‡ï¼Œæ§åˆ¶ä»½é‡å°±ä¸å…§ç–šã€‚</p>
          <a class="btn" href="./analyzer.html">ç”¨åˆ†æå™¨ä¼°å¡è·¯é‡Œ</a>
        </div>
        <div class="recipe cardish">
          <picture><source srcset="./assets/feature-mind-body.webp" type="image/webp"><img class="photo" src="./assets/feature-mind-body.jpg" alt="åœ°ä¸­æµ·é®ªé­šæ²™æ‹‰ï¼šé«˜è›‹ç™½ã€é«˜çº–ç¶­" loading="lazy" decoding="async"></picture>
          <strong>åœ°ä¸­æµ·é®ªé­šæ²™æ‹‰</strong>
          <p class="muted">é«˜è›‹ç™½ã€é«˜çº–ç¶­ï¼Œé£½è¶³æ„Ÿæ›´ä¹…ã€‚</p>
          <a class="btn" href="./analyzer.html">ç”¨åˆ†æå™¨ä¼°å¡è·¯é‡Œ</a>
        </div>
      </div>
      <button class="car-btn next" id="car-next" aria-label="ä¸‹ä¸€å€‹">â€º</button>
    </div>

    <!-- Bundle -->
    <section id="bundle" class="bundle">
      <div>
        <div class="mini" style="margin-bottom:8px">
          <img src="./assets/poster-reset-8w.jpg" alt="8 é€±æˆ’ç³–å…¥é–€å°é¢ç¸®åœ–" loading="lazy" decoding="async">
          <img src="./assets/poster-breakfast-20.jpg" alt="ä½ç³–æ—©é¤ 20 é“å°é¢ç¸®åœ–" loading="lazy" decoding="async">
          <img src="./assets/poster-eating-out.jpg" alt="å¤–é£Ÿå°‘ç³–å°æŠ„å°é¢ç¸®åœ–" loading="lazy" decoding="async">
          <img src="./assets/poster-desserts-15.jpg" alt="é›¶ç³–ç”œé» 15 é“å°é¢ç¸®åœ–" loading="lazy" decoding="async">
        </div>
        <h3 class="title">Ebook Bundleï½œä¸€æ¬¡å…¥æ‰‹æœ€å¯¦ç”¨çš„ 4 æœ¬æŒ‡å—</h3>
        <p class="desc">å¾ 8 é€±æˆ’ç³–å…¥é–€åˆ°å¤–é£Ÿã€æ—©é¤èˆ‡é›¶ç³–ç”œé»ï¼Œå¹«ä½ æŠŠæ¸›ç³–è½åœ°åˆ°æ—¥å¸¸ã€‚</p>
        <div class="actions">
          <a class="btn primary" href="./ebooks.html">å‰å¾€é›»å­æ›¸å•†åº—</a>
          <a class="btn" href="./ebooks.html#bundle">äº†è§£å¥—çµ„å„ªæƒ </a>
        </div>
      </div>
      <div class="right">
        <span class="badge">ğŸ å¤šæœ¬åˆè³¼æ›´åˆ’ç®—</span>
      </div>
    </section>

    <!-- æˆåŠŸæ•…äº‹ -->
    <h3 id="stories" class="section-title">æˆåŠŸæ•…äº‹</h3>
    <div class="testimonials">
      <blockquote class="quote">
        <img class="avatar" src="./assets/extras-testimonials.jpg" alt="Yumi é ­åƒ" loading="lazy" decoding="async">
        <div><p>ä¸‰é€±å¾Œä¸‹åˆå´©å£æ¶ˆå¤±äº†ï¼Œçš®è†šä¹Ÿç©©å®šè¨±å¤šï¼</p><footer>â€” Yumiï¼è¨­è¨ˆå¸«</footer></div>
      </blockquote>
      <blockquote class="quote">
        <img class="avatar" src="./assets/extras-testimonials.jpg" alt="Irene é ­åƒ" loading="lazy" decoding="async">
        <div><p>ç”¨ã€Œé€£å‹ã€çœ‹é€²æ­¥ï¼Œæ¯”é«”é‡è¨ˆæ›´æ¿€å‹µï¼›ç¾åœ¨ç”œé£²ä¸€é€±åªå–ä¸€æ¬¡ã€‚</p><footer>â€” Ireneï¼è¡ŒéŠ·äºº</footer></div>
      </blockquote>
    </div>

    <!-- FAQ -->
    <h3 id="faq" class="section-title">å¸¸è¦‹å•é¡Œ</h3>
    <details class="faq"><summary>ä¸€å®šè¦ 8 é€±å—ï¼Ÿ</summary><p class="muted">å»ºè­° 8 é€±ä½œç‚ºå®Œæ•´å¾ªç’°ï¼›ä¹Ÿå¯ä¾ç”Ÿæ´»ç¯€å¥èª¿æ•´ã€‚</p></details>
    <details class="faq"><summary>éœ€è¦å®Œå…¨ä¸åƒç³–å—ï¼Ÿ</summary><p class="muted">ä¸ç”¨æ¥µç«¯ï¼›æˆ‘å€‘æ¨ã€Œæ›´å°‘ç³–ã€å°‘åŠ å·¥ã€ï¼ŒæŒçºŒæœ€é‡è¦ã€‚</p></details>

    <!-- ä¸»è¦åŠŸèƒ½ï¼šæ¿€å‹µ / å¾…è¾¦ / ç™»å…¥èˆ‡é€£å‹ -->
    <div class="grid-2">
      <!-- å·¦å´ï¼šæ¿€å‹µèˆ‡ä»£è¾¦ -->
      <section class="card">
        <span class="kicker">åŸºæœ¬åŸå‰‡ & æ¯æ—¥æ¿€å‹µ</span>
        <h2>ä»Šå¤©å°±é–‹å§‹ï¼Œå…ˆåšåˆ° 1 ä»¶å°äº‹</h2>
        <p id="motivation" class="muted">â€¦â€¦</p>

        <!-- æ¯æ—¥é©šå–œå¡ -->
        <div class="surprise" id="surprise">
          <div class="title">ğŸ ä»Šæ—¥é©šå–œå¡</div>
          <div class="muted" id="surprise-text">é»ä¸€ä¸‹æŠ½å¡ï¼Œæ‹¿åˆ°ä»Šå¤©çš„å°ä»»å‹™æˆ–æº«æŸ”æé†’ã€‚</div>
          <button class="btn" id="surprise-btn" type="button" style="margin-top:8px">æŠ½ä¸€å¼µ</button>
        </div>

        <h3 style="margin-top:14px">å¥åº·è¡Œå‹•æ¸…å–®</h3>
        <div class="list" id="todo-list"></div>
        <div class="row2" style="margin-top:10px">
          <input id="todo-input" placeholder="+ æ–°å¢ä¸€å€‹ä»Šæ—¥å°è¡Œå‹•ï¼Œä¾‹å¦‚ï¼šæ™šé¤ä¸å–å«ç³–é£²æ–™"/>
          <button class="btn" id="todo-add">åŠ å…¥</button>
        </div>
      </section>

      <!-- å³å´ï¼šç™»å…¥èˆ‡é€£å‹ -->
      <section id="auth" class="card">
        <span class="kicker">å€‹äººåŒ–è¿½è¹¤</span>
        <h2>è¨»å†Š / ç™»å…¥</h2>
        <p class="muted" style="margin-top:-6px;margin-bottom:12px">è¨»å†Šå³å¯å…è²»ç²å–æ¯é€±æˆ’ç³–é›»å­å ±ã€‚</p>
        <div class="row2">
          <input id="signup-email" placeholder="Emailï¼ˆå»ºè­°æ‰‹å‹•è¼¸å…¥ï¼‰" autocomplete="username" />
          <input id="signup-password" placeholder="å¯†ç¢¼ï¼ˆè‡³å°‘ 6 ç¢¼ï¼‰" type="password" autocomplete="new-password" />
        </div>
        <div class="row2" style="margin-top:8px">
          <button class="btn primary" id="btn-signup">è¨»å†Š</button>
          <button class="btn" id="btn-login">ç™»å…¥</button>
        </div>
        <div class="row" style="margin-top:8px">
          <button class="btn ghost" id="btn-logout" style="display:none">ç™»å‡º</button>
        </div>
        <div id="auth-error" class="error" style="display:none;margin-top:10px"></div>

        <hr style="margin:16px -18px;border-color:#e5e7eb;border-style:solid;border-width:1px 0 0"/>

        <h3>æˆ‘çš„æˆ’ç³–é‡Œç¨‹ç¢‘</h3>
        <div class="stat">
          <div><div class="muted">ç•¶å‰é€£å‹ï¼ˆå¤©ï¼‰</div><div class="num" id="current-streak">â€”</div></div>
          <div><div class="muted">æ­·å²æœ€é•·ï¼ˆå¤©ï¼‰</div><div class="num" id="max-streak">â€”</div></div>
        </div>

        <!-- å¾½ç«  -->
        <div class="badges" id="badge-list" aria-label="é€£å‹å¾½ç« ">
          <div class="badge" data-threshold="7">ğŸ… 7 å¤©</div>
          <div class="badge" data-threshold="14">ğŸ† 14 å¤©</div>
          <div class="badge" data-threshold="28">ğŸ’ 28 å¤©</div>
        </div>

        <!-- æ¯é€±æŒ‘æˆ° -->
        <div class="progress-wrap">
          <div class="muted" style="margin:8px 0 6px"><strong>æ¯é€±æŒ‘æˆ°ï¼š</strong>æ™šé¤ä¸å–å«ç³–é£²æ–™</div>
          <div class="progress-bar"><span id="week-fill"></span></div>
          <small class="muted"><span id="week-label">æœ¬é€±å®Œæˆ 0 / 7 å¤©</span></small>
        </div>

        <div class="row2" style="margin-top:12px">
          <button class="btn" id="btn-i-did-good" type="button">æˆ‘ä»Šå¤©æˆ’ç³– âœ…</button>
          <button class="btn danger" id="btn-reset" type="button">æˆ‘å¤±æ‰‹äº†ï¼Œé‡æ–°é–‹å§‹</button>
        </div>
        <small class="muted">æç¤ºï¼šç™»å…¥å¾Œæ‰æœƒå¯«å…¥/è®€å–è³‡æ–™è¡¨ <code>streaks</code>ã€‚</small>
      </section>
    </div>
  </main>

  <footer class="wrap" role="contentinfo">
    <p>Â© 2025 Quit Sugar. GitHub Pages Ã— Supabase</p>
  </footer>

<script>
  // ===== å»¶é²ç­‰å¾… SDK =====
  async function waitSupabaseReady(ms = 4000) {
    const start = Date.now();
    while (!window.supabase && Date.now() - start < ms) {
      await new Promise(r => setTimeout(r, 50));
    }
    return !!window.supabase;
  }

  // ===== å°å·¥å…· =====
  const $ = (id) => document.getElementById(id);
  const showErr = (msg) => { const box = $('auth-error'); if(!box) return; box.style.display = 'block'; box.textContent = msg; };
  const hideErr = () => { const box = $('auth-error'); if(!box) return; box.style.display = 'none'; box.textContent = ''; };

  // å€’æ•¸ï¼ˆä¿ƒéŠ·æ¢ï¼‰ï¼šé è¨­ 48 å°æ™‚
  (function promoCountdown(){
    const el = $('promo-count'); if(!el) return;
    const end = Date.now() + 1000*60*60*48;
    const tick = () => {
      const left = Math.max(0, end - Date.now());
      const h = String(Math.floor(left/3600000)).padStart(2,'0');
      const m = String(Math.floor((left%3600000)/60000)).padStart(2,'0');
      const s = String(Math.floor((left%60000)/1000)).padStart(2,'0');
      el.textContent = `${h}:${m}:${s}`;
    };
    tick(); setInterval(tick, 1000);
  })();

  // æ¿€å‹µèªå¥
  const QUOTES = [
    'å°‘ç³–ä¸€é»ï¼Œæ¸…é†’å¤šä¸€é»ã€‚','ä»Šå¤©çš„ä½ ï¼Œåªè¦æ¯”æ˜¨å¤©æ›´å¥½ 1%ã€‚',
    'æˆ’æ‰ä¸æ˜¯å¿«ç‹ æº–ï¼Œè€Œæ˜¯æŒçºŒåšå°äº‹ã€‚','æƒ³åƒç”œçš„ï¼Ÿå…ˆå–ä¸€æ¯æ°´ï¼Œç­‰äº”åˆ†é˜å†æ±ºå®šã€‚','æŠŠæ¸´æœ›å¯«ä¸‹ä¾†ï¼Œè®“å®ƒé›¢é–‹è…¦è¢‹ã€‚',
  ];
  function pickQuote(){ $('motivation').textContent = QUOTES[Math.floor(Math.random()*QUOTES.length)]; }

  // æ—¥é©šå–œå¡ï¼ˆæ¯æ—¥ä¸€æ¬¡ï¼‰
  const SURPRISES = [
    'ä»Šæ™šæ”¹å–ç„¡ç³–æ°£æ³¡æ°´ï¼‹æª¸æª¬ç‰‡ ğŸ‹',
    'ç¡å‰ 5 åˆ†é˜ä¼¸å±•ï¼Œå¹«åŠ©éš”å¤©ä¸çˆ†é¤“ ğŸ§˜â€â™€ï¸',
    'æŠŠç”œé»åˆ†æˆå…©æ¬¡åƒï¼šç¾åœ¨ä¸€åŠï¼Œå‰©ä¸‹ç•™æ˜å¤© âœ‚ï¸',
    'å¤–é£Ÿå…ˆå–ä¸€æ¯æ°´å†é»é¤ï¼Œé£½è¶³æ„Ÿ up ğŸ’§',
    'ä»Šå¤©çš„ç”œå‘³ä¾†æºï¼šè“æœä¸€å°ç¢— ğŸ“'
  ];
  function initSurprise(){
    const key = 'qs.surprise.' + new Date().toISOString().slice(0,10);
    const btn = $('surprise-btn'), box = $('surprise-text');
    const saved = localStorage.getItem(key);
    if(saved){ box.textContent = saved; btn.disabled = true; btn.textContent = 'å·²æŠ½å¡'; return; }
    btn.addEventListener('click', ()=>{
      const pick = SURPRISES[Math.floor(Math.random()*SURPRISES.length)];
      box.textContent = pick;
      localStorage.setItem(key, pick);
      btn.disabled = true; btn.textContent = 'å·²æŠ½å¡';
    });
  }

  // ===== TODOï¼ˆæœ¬åœ°å„²å­˜ï¼‰ =====
  const TODO_KEY = 'qs.todos.v1';
  function readTodos(){ try { return JSON.parse(localStorage.getItem(TODO_KEY)) || []; } catch { return []; } }
  function writeTodos(list){ localStorage.setItem(TODO_KEY, JSON.stringify(list)); renderTodos(); }
  function renderTodos(){
    const list = readTodos();
    const wrap = $('todo-list');
    wrap.innerHTML='';
    list.forEach((t,i)=>{
      const row = document.createElement('div');
      row.className = 'todo';
      const cb = document.createElement('input'); cb.type='checkbox'; cb.checked = !!t.done; cb.addEventListener('change',()=>{ list[i].done = cb.checked; writeTodos(list); });
      const span = document.createElement('span'); span.textContent = t.text; span.className='muted';
      const del = document.createElement('button'); del.className='btn ghost'; del.textContent='åˆªé™¤'; del.addEventListener('click',()=>{ list.splice(i,1); writeTodos(list); });
      row.append(cb, span, del);
      wrap.append(row);
    });
  }

  // ===== é€±é€²åº¦ï¼ˆæœ¬åœ°å„²å­˜ï¼‰ =====
  function isoWeek(d=new Date()){
    const t = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
    const dayNum = t.getUTCDay() || 7;
    t.setUTCDate(t.getUTCDate() + 4 - dayNum);
    const yearStart = new Date(Date.UTC(t.getUTCFullYear(),0,1));
    const weekNum = Math.ceil((((t - yearStart)/86400000) + 1)/7);
    return {year: t.getUTCFullYear(), week: weekNum};
  }
  function todayStr(){ return new Date().toISOString().slice(0,10); }
  const WEEK_KEY_PREFIX = 'qs.weekMarks.';
  function weekKey(d=new Date()){ const w = isoWeek(d); return `${WEEK_KEY_PREFIX}${w.year}-${w.week.toString().padStart(2,'0')}`; }
  function getWeekSet(){ const raw = localStorage.getItem(weekKey()) || '[]'; try { return new Set(JSON.parse(raw)); } catch { return new Set(); } }
  function saveWeekSet(set){ localStorage.setItem(weekKey(), JSON.stringify(Array.from(set))); }
  function updateWeekUI(){
    const set = getWeekSet();
    const n = Math.min(7, set.size);
    const percent = (n/7)*100;
    $('week-fill').style.width = percent + '%';
    $('week-label').textContent = `æœ¬é€±å®Œæˆ ${n} / 7 å¤©`;
  }
  function recordTodayIfNew(){
    const set = getWeekSet();
    const t = todayStr();
    if(!set.has(t)){ set.add(t); saveWeekSet(set); }
    updateWeekUI();
  }

  // ===== è¼ªæ’­åˆå§‹åŒ– =====
  function initCarousel(){
    const track = $('car-track');
    const prev = $('car-prev');
    const next = $('car-next');
    if(!track || !prev || !next) return;
    const firstCard = track.querySelector('.recipe');
    const gap = 12;
    const prefersReduced = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    const stepPx = () => (firstCard ? firstCard.clientWidth + gap : Math.max(300, track.clientWidth * 0.9));
    function updateArrows(){ const canScroll = track.scrollWidth > track.clientWidth + 1; prev.style.display = next.style.display = canScroll ? 'inline-flex' : 'none'; }
    prev.addEventListener('click', () => track.scrollBy({ left: -stepPx(), behavior: prefersReduced ? 'auto':'smooth' }));
    next.addEventListener('click', () => track.scrollBy({ left:  stepPx(), behavior: prefersReduced ? 'auto':'smooth' }));
    window.addEventListener('resize', updateArrows);
    updateArrows();
  }

  // ===== Supabaseï¼ˆä½ çš„å°ˆæ¡ˆï¼‰ =====
  const SUPABASE_URL = "https://scquprvywjtuvcxxfsco.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNjcXVwcnZ5d2p0dXZjeHhmc2NvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4MzAxMTQsImV4cCI6MjA3MTQwNjExNH0.iUZ_lI-mHoGoz2NfPTifYe44zieUIBUREF6fxsry97I";
  let supabaseClient = null;

  // ===== ä¸»æµç¨‹ =====
  window.addEventListener('DOMContentLoaded', async () => {
    pickQuote();
    initSurprise();
    renderTodos();
    updateWeekUI();
    initCarousel();

    // å¾…è¾¦äº‹ä»¶
    $('todo-add').addEventListener('click', ()=>{
      const v = $('todo-input').value.trim();
      if(!v) return;
      const list = readTodos();
      list.unshift({ text:v, done:false });
      writeTodos(list);
      $('todo-input').value = '';
    });

    // é å…ˆç¦ç”¨éœ€ç™»å…¥çš„æŒ‰éˆ•
    $('btn-i-did-good').disabled = true;
    $('btn-reset').disabled = true;

    // ç­‰å¾… Supabase
    const ok = await waitSupabaseReady(4000);
    if (!ok) { showErr('Supabase SDK æœªè¼‰å…¥å®Œæˆï¼Œç™»å…¥/é€£å‹åŠŸèƒ½æš«ä¸å¯ç”¨ï¼›å…¶ä»–åŠŸèƒ½æ­£å¸¸ã€‚'); return; }

    // åˆå§‹åŒ– client
    supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
      auth: { persistSession: true, autoRefreshToken: true, detectSessionInUrl: false }
    });

    // Auth
    function normalizeEmail(raw){ return (raw ?? '').normalize('NFKC').replace(/[\u200B-\u200D\uFEFF]/g, '').trim(); }
    function basicEmailOK(s){ return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s); }

    async function signup(){
      hideErr();
      const email = normalizeEmail($('signup-email').value);
      const password = $('signup-password').value;
      if(!basicEmailOK(email)) return showErr('è«‹è¼¸å…¥æœ‰æ•ˆçš„ Email');
      if((password||'').length < 6) return showErr('å¯†ç¢¼è‡³å°‘ 6 ç¢¼');
      const { data, error } = await supabaseClient.auth.signUp({ email, password });
      if(error){ return showErr('è¨»å†Šå¤±æ•—ï¼š' + (error.message || 'æœªçŸ¥éŒ¯èª¤')); }
      if(!data.session){ return showErr('è‹¥å•Ÿç”¨ä¿¡ç®±é©—è­‰ï¼Œè«‹è‡³ä¿¡ç®±æ”¶ä¿¡å¾Œå†å›ä¾†æŒ‰ã€Œç™»å…¥ã€ã€‚'); }
      await afterLogin();
    }

    async function login(){
      hideErr();
      const email = normalizeEmail($('signup-email').value);
      const password = $('signup-password').value;
      if(!basicEmailOK(email)) return showErr('è«‹è¼¸å…¥æœ‰æ•ˆçš„ Email');
      if((password||'').length < 6) return showErr('å¯†ç¢¼è‡³å°‘ 6 ç¢¼');
      const { error } = await supabaseClient.auth.signInWithPassword({ email, password });
      if(error){ return showErr('ç™»å…¥å¤±æ•—ï¼š' + (error.message || 'æœªçŸ¥éŒ¯èª¤')); }
      await afterLogin();
    }

    async function logout(){ await supabaseClient.auth.signOut(); renderSession(null); }

    function renderSession(session){
      const quickBtns = ['btn-i-did-good','btn-reset'];
      if(session){
        document.querySelector('.nav-links .btn.primary').textContent = session.user?.email || 'å·²ç™»å…¥';
        document.getElementById('btn-logout').style.display = 'inline-flex';
        quickBtns.forEach(id=>$(id).disabled=false);
      }else{
        document.querySelector('.nav-links .btn.primary').textContent = 'åŠ å…¥æŒ‘æˆ° / ç™»å…¥';
        document.getElementById('btn-logout').style.display = 'none';
        $('current-streak').textContent = 'â€”';
        $('max-streak').textContent = 'â€”';
        quickBtns.forEach(id=>$(id).disabled=true);
      }
    }

    // Streaks
    function daysBetween(start){
      const s = new Date(start + 'T00:00:00');
      const today = new Date();
      const diff = Math.floor((Date.UTC(today.getFullYear(),today.getMonth(),today.getDate()) - Date.UTC(s.getFullYear(),s.getMonth(),s.getDate())) / (1000*60*60*24));
      return Math.max(0, diff+1);
    }

    async function ensureStreakRow(userId){
      const { data, error } = await supabaseClient.from('streaks').select('*').eq('user_id', userId).maybeSingle();
      if(error){ showErr('è®€å– streaks å¤±æ•—ï¼š' + error.message); return null; }
      if(data){ return data; }
      const today = new Date().toISOString().slice(0,10);
      const { data: inserted, error: e2 } = await supabaseClient.from('streaks').insert({
        user_id: userId, current_streak_start_date: today, max_streak_days: 0
      }).select().single();
      if(e2){ showErr('å»ºç«‹ streaks å¤±æ•—ï¼š' + e2.message); return null; }
      return inserted;
    }

    function updateBadgesUI(currentDays){
      const list = document.querySelectorAll('#badge-list .badge');
      list.forEach(b=>{
        const need = Number(b.getAttribute('data-threshold')||0);
        b.classList.toggle('unlocked', currentDays >= need);
      });
    }

    async function refreshStreaks(){
      const { data: { session } } = await supabaseClient.auth.getSession();
      if(!session){ return; }
      const row = await ensureStreakRow(session.user.id);
      if(!row) return;
      const current = daysBetween(row.current_streak_start_date);
      $('current-streak').textContent = current;
      $('max-streak').textContent = row.max_streak_days ?? 0;
      updateBadgesUI(current);
    }

    async function markGoodToday(){
      const { data: { session } } = await supabaseClient.auth.getSession();
      if(!session) return showErr('è«‹å…ˆç™»å…¥');
      const row = await ensureStreakRow(session.user.id);
      if(!row) return;
      const current = daysBetween(row.current_streak_start_date);
      const newMax = Math.max(row.max_streak_days ?? 0, current);
      const { error } = await supabaseClient.from('streaks').update({ max_streak_days: newMax }).eq('user_id', session.user.id);
      if(error) return showErr('æ›´æ–°å¤±æ•—ï¼š' + error.message);
      recordTodayIfNew();
      await refreshStreaks();
    }

    async function resetStreak(){
      const { data: { session } } = await supabaseClient.auth.getSession();
      if(!session) return showErr('è«‹å…ˆç™»å…¥');
      const today = new Date().toISOString().slice(0,10);
      const { error } = await supabaseClient.from('streaks').update({ current_streak_start_date: today }).eq('user_id', session.user.id);
      if(error) return showErr('é‡ç½®å¤±æ•—ï¼š' + error.message);
      await refreshStreaks();
    }

    async function afterLogin(){
      const { data: { session } } = await supabaseClient.auth.getSession();
      renderSession(session);
      await refreshStreaks();
    }

    // ç¶å®š
    $('btn-signup').addEventListener('click', signup);
    $('btn-login').addEventListener('click', login);
    $('btn-logout').addEventListener('click', logout);
    $('btn-i-did-good').addEventListener('click', markGoodToday);
    $('btn-reset').addEventListener('click', resetStreak);

    // åˆå§‹åŒ– Session
    const { data: { session } } = await supabaseClient.auth.getSession();
    renderSession(session);
    if(session){ await refreshStreaks(); }

    // ç›£è½ç™»å…¥ç‹€æ…‹
    supabaseClient.auth.onAuthStateChange(function(_evt, sess){ renderSession(sess); if(sess){ refreshStreaks(); } });
  });

  // åœ–ç‰‡ fallbackï¼ˆé¿å…ç ´åœ–ï¼‰
  (function () {
    function fallback(node, emoji) {
      var ph = document.createElement('div');
      ph.className = 'photo';
      ph.style.display='grid'; ph.style.placeItems='center'; ph.style.background='#f8fafc'; ph.style.border='1px solid var(--line)'; ph.style.borderRadius='12px';
      ph.textContent = emoji || 'ğŸ–¼ï¸';
      node.replaceWith(ph);
    }
    document.addEventListener('error', function(e){
      const img = e.target;
      if(img.tagName === 'IMG'){
        if (img.closest('.feature')) return fallback(img, 'ğŸ“·');
        if (img.closest('.step')) return fallback(img, 'ğŸ§©');
        if (img.closest('.recipe')) return fallback(img, 'ğŸ¥—');
        if (img.closest('.bundle')) return fallback(img, 'ğŸ');
        fallback(img, 'ğŸ–¼ï¸');
      }
    }, true);
  })();

  /* === æ–°å¢ï¼šæ¼¢å ¡æŠ½å±œå°è¦½ JS === */
  (function(){
    var desktopNav = document.querySelector('.nav-links');
    var mobileNav  = document.getElementById('m-nav');
    var burger     = document.getElementById('m-burger');
    var drawer     = document.getElementById('m-menu');
    var backdrop   = document.getElementById('m-backdrop');
    var closeBtn   = document.getElementById('m-close');
    if (!desktopNav || !mobileNav || !burger || !drawer || !backdrop || !closeBtn) return;

    // è¤‡è£½æ¡Œé¢å°è¦½å…§å®¹åˆ°è¡Œå‹•æŠ½å±œ
    mobileNav.innerHTML = desktopNav.innerHTML;

    function openDrawer(){
      drawer.classList.add('open');
      backdrop.hidden = false;
      burger.setAttribute('aria-expanded','true');
      document.body.style.overflow = 'hidden';
    }
    function closeDrawer(){
      drawer.classList.remove('open');
      backdrop.hidden = true;
      burger.setAttribute('aria-expanded','false');
      document.body.style.overflow = '';
    }
    burger.addEventListener('click', openDrawer);
    closeBtn.addEventListener('click', closeDrawer);
    backdrop.addEventListener('click', closeDrawer);
    document.addEventListener('keydown', function(e){ if(e.key === 'Escape') closeDrawer(); });
    mobileNav.addEventListener('click', function(e){ if (e.target.tagName === 'A') closeDrawer(); });
  })();
</script>

</body>
</html>
