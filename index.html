<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>戒糖計畫｜Quit Sugar</title>
  <meta name="description" content="簡單開始的戒糖網站：註冊登入、追蹤連勝、健康行動清單與每日激勵。" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
  :root { --bg:#ffffff; --card:#ffffff; --muted:#4b5563; --text:#111827; --brand:#22c55e; --danger:#ef4444; }
  *{box-sizing:border-box}
  body{margin:0;background:#ffffff;color:var(--text);font-family:'Noto Sans TC',system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;}
  .wrap{max-width:980px;margin:0 auto;padding:32px 20px 80px}
  header{display:flex;gap:16px;align-items:center;justify-content:space-between;margin-bottom:24px}
  .brand{display:flex;gap:12px;align-items:center}
  .logo{width:42px;height:42px;border-radius:12px;background:linear-gradient(135deg,#16a34a,#22c55e);display:grid;place-items:center;color:#04120b;font-weight:900}
  h1{margin:0;font-size:22px;letter-spacing:0.5px}
  .card{background:var(--card);border:1px solid #e5e7eb;border-radius:18px;padding:18px}
  .grid{display:grid;gap:16px}
  @media(min-width:960px){.grid{grid-template-columns:1.1fr 1fr}}
  h2{font-size:18px;margin:0 0 10px}
  h3{font-size:16px;margin:16px 0 8px}
  p,li,small{color:var(--muted)}
  input,button{font:inherit}
  input{width:100%;background:#ffffff;border:1px solid #d1d5db;padding:10px 12px;border-radius:10px;color:var(--text)}
  .row{display:grid;gap:10px}
  .row2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .btn{display:inline-flex;align-items:center;gap:8px;border:1px solid #e5e7eb;padding:10px 14px;border-radius:12px;background:#f9fafb;color:var(--text);cursor:pointer}
  .btn.primary{background:linear-gradient(135deg,#16a34a,#22c55e);color:#04120b;border:none;font-weight:700}
  .btn.ghost{background:transparent}
  .btn.danger{background:linear-gradient(135deg,#ef4444,#b91c1c);border:none;color:#fff}
  .stat{display:flex;gap:14px;align-items:center}
  .stat .num{font-size:28px;font-weight:800}
  .kicker{display:inline-block;padding:4px 8px;border-radius:999px;background:#f1f5f9;border:1px solid #e5e7eb;color:#2563eb;font-size:12px}
  .list{display:grid;gap:8px}
  .todo{display:flex;align-items:center;gap:10px}
  .todo input[type=checkbox]{width:18px;height:18px}
  .muted{color:var(--muted)}
  .error{border-left:3px solid var(--danger);padding:10px 12px;background:#fff5f5;border-radius:12px}
  footer{margin-top:28px;text-align:center;color:var(--muted)}
  code{background:#f1f5f9;padding:2px 6px;border-radius:6px;border:1px solid #e5e7eb}
  hr{border-color:#e5e7eb;}
  nav.top-nav{display:flex;gap:12px;align-items:center;padding:8px 0 12px;margin:0 0 16px;border-bottom:1px solid #e5e7eb;}
  nav.top-nav a{color:#2563eb;text-decoration:none}
  nav.top-nav a:hover{text-decoration:underline}
</style>

  <!-- 全域錯誤顯示 -->
  <script>
    window.onerror = function(msg, src, line, col) {
      const el = document.getElementById("auth-error");
      if (el) {
        el.style.display = "block";
        el.textContent = "前端錯誤： " + msg + " (" + src + ":" + line + ":" + col + ")";
      }
    };
  </script>

  <!-- Supabase JS：雙 CDN with fallback -->
  <script>
    (function loadSupabaseSDK() {
      const primary = "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.4/dist/umd/supabase.min.js";
      const fallback = "https://unpkg.com/@supabase/supabase-js@2.45.4/dist/umd/supabase.min.js";
      function append(src) {
        const s = document.createElement("script");
        s.src = src;
        s.defer = true;
        s.onload = () => console.log("Supabase SDK loaded: ", src);
        s.onerror = () => {
          if (src === primary) append(fallback);
          else alert("載入 Supabase SDK 失敗，請稍後重試。");
        };
        document.head.appendChild(s);
      }
      append(primary);
    })();
  </script>
</head>
<body>
<div class="wrap">
  <header>
    <div class="brand">
      <div class="logo">QS</div>
      <div>
        <h1>戒糖計畫 Quit Sugar</h1>
        <small class="muted">輕鬆開始、持續記錄、看見改變</small>
      </div>
    </div>
    <div id="auth-quick" class="muted"></div>
  </header>

  <!-- 導覽列（可自行調整/新增連結） -->
  <nav class="top-nav">
    <a href="./">戒糖首頁</a>
    <a href="https://abbby9377.github.io/food-calorie-analyzer/" target="_blank" rel="noopener">食物卡路里分析器</a></nav>

  <div class="grid">
    <section class="card">
      <span class="kicker">基本原則 & 每日激勵</span>
      <h2>今天就開始，先做到 1 件小事</h2>
      <p id="motivation" class="muted">……</p>
      <h3>健康行動清單</h3>
      <div class="list" id="todo-list"></div>
      <div class="row2" style="margin-top:10px">
        <input id="todo-input" placeholder="+ 新增一個今日小行動，例如：晚餐不喝含糖飲料"/>
        <button class="btn" id="todo-add">加入</button>
      </div>
    </section>

    <section class="card">
      <span class="kicker">個人化追蹤</span>
      <h2>註冊 / 登入</h2>
      <div class="row2">
        <input id="signup-email" placeholder="Email（建議手動輸入）" autocomplete="username" />
        <input id="signup-password" placeholder="密碼（至少 6 碼）" type="password" autocomplete="new-password" />
      </div>
      <div class="row2" style="margin-top:8px">
        <button class="btn primary" id="btn-signup">註冊</button>
        <button class="btn" id="btn-login">登入</button>
      </div>
      <div class="row" style="margin-top:8px">
        <button class="btn ghost" id="btn-logout" style="display:none">登出</button>
      </div>
      <div id="auth-error" class="error" style="display:none;margin-top:10px"></div>

      <hr style="margin:16px -18px;border-color:#1f2937;border-style:solid;border-width:1px 0 0"/>

      <h3>我的戒糖里程碑</h3>
      <div class="stat">
        <div>
          <div class="muted">當前連勝（天）</div>
          <div class="num" id="current-streak">—</div>
        </div>
        <div>
          <div class="muted">歷史最長（天）</div>
          <div class="num" id="max-streak">—</div>
        </div>
      </div>
      <div class="row2" style="margin-top:12px">
        <button class="btn" id="btn-i-did-good">我今天戒糖 ✅</button>
        <button class="btn danger" id="btn-reset">我失手了，重新開始</button>
      </div>
      <small class="muted">提示：登入後才會寫入/讀取資料表 <code>streaks</code>。</small>
    </section>
  </div>

  <footer>
    <p>© 2025 Quit Sugar. GitHub Pages × Supabase</p>
  </footer>
</div>

<script>
  window.addEventListener('DOMContentLoaded', async () => {
    // 等待 Supabase SDK 載入
    const start = Date.now();
    while (!window.supabase && Date.now() - start < 5000) {
      await new Promise(r => setTimeout(r, 100));
    }
    if (!window.supabase) {
      const el = document.getElementById("auth-error");
      if (el) {
        el.style.display = "block";
        el.textContent = "Supabase SDK 未載入完成，請重新整理或稍後再試。";
      }
      return;
    }

    // Supabase client init
    const SUPABASE_URL = "https://scquprvywjtuvcxxfsco.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNjcXVwcnZ5d2p0dXZjeHhmc2NvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4MzAxMTQsImV4cCI6MjA3MTQwNjExNH0.iUZ_lI-mHoGoz2NfPTifYe44zieUIBUREF6fxsry97I";
    const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
      auth: { persistSession: true, autoRefreshToken: true, detectSessionInUrl: false }
    });

    // 簡化：僅示範 UI 初始化 + 確認 SDK 可用
    document.getElementById("motivation").textContent = "少糖一點，清醒多一點。";
    document.getElementById("todo-add").addEventListener("click", () => {
      alert("TODO 測試正常");
    });
  });
</script>
</body>
</html>
