<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>å¡è·¯é‡Œç†±é‡åˆ†æå™¨ï½œCalorie Analyzer</title>
<meta name="description" content="ä½ çš„æ™ºæ…§ç†±é‡æŒ‡å—ï¼šè¼¸å…¥é£Ÿç‰©å³å¯å¾—åˆ°ç†±é‡èˆ‡ç‡Ÿé¤Šç´ æ¯”ä¾‹ï¼Œä¸¦é™„ä¸Šåœ–è¡¨èˆ‡å»ºè­°ã€‚"/>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;600;700;800&display=swap" rel="stylesheet">

<style>
  :root{
    --bg:#ffffff; --text:#0f172a; --muted:#475569; --line:#e5e7eb;
    --brand:#ec4899; --brand-2:#f472b6; --brand-3:#fb7185;
    --accent:#fdf2f8; --chip:#eef2ff;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; background:var(--bg); color:var(--text);
    font-family:'Noto Sans TC',system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    -webkit-font-smoothing:antialiased; line-height:1.55;
  }
  .wrap{max-width:1024px;margin:0 auto;padding:28px 18px 80px}

  header{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
  .brand{display:flex;gap:12px;align-items:center}
  .logo{width:42px;height:42px;border-radius:12px;display:grid;place-items:center;color:#fff;font-weight:900;
        background:linear-gradient(135deg,var(--brand-2),var(--brand-3))}
  h1{margin:0;font-size:22px}
  small.muted{color:var(--muted)}

  /* nav */
  .top-nav{display:flex;gap:14px;align-items:center;padding:10px 0 16px;margin:0 0 16px;border-bottom:1px solid var(--line)}
  .top-nav a{color:#2563eb;text-decoration:none}
  .top-nav a:hover{text-decoration:underline}

  /* Hero */
  #hero{
    margin:6px 0 22px; padding:34px 20px;
    background:linear-gradient(135deg,var(--accent),#fff);
    border:1px solid var(--line); border-radius:26px;
  }
  #hero h2{margin:0 0 10px; font-size:36px; line-height:1.2}
  #hero p{margin:0; color:var(--muted); font-size:18px}
  #hero .actions{margin-top:16px; display:flex; gap:10px; flex-wrap:wrap}
  .btn{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--line);
       padding:12px 16px;border-radius:999px;background:#f8fafc;color:var(--text);cursor:pointer}
  .btn.primary{background:linear-gradient(135deg,var(--brand-2),var(--brand));color:#fff;border:none;font-weight:800}

  /* Value Proposition */
  #value-prop{margin:6px 0 24px}
  #value-prop h3{margin:0 0 12px; font-size:20px}
  .vp-grid{display:grid; gap:12px}
  @media(min-width:760px){ .vp-grid{grid-template-columns:repeat(4,1fr)} }
  .vp{border:1px solid var(--line); border-radius:16px; padding:14px; background:#fff}
  .vp .ico{width:36px;height:36px;border-radius:10px;display:grid;place-items:center;margin-bottom:6px;
           background:linear-gradient(135deg,#fde68a,#fca5a5)}
  .vp strong{display:block;margin-bottom:4px}
  .muted{color:var(--muted)}

  /* Analyzer */
  #analyzer{margin:10px 0 24px}
  .card{background:#fff;border:1px solid var(--line);border-radius:18px;padding:16px}
  .grid{display:grid; gap:14px}
  @media(min-width:900px){ .grid{grid-template-columns:1.2fr 1fr} }
  label{font-weight:700;font-size:14px}
  input[type=text]{width:100%;padding:12px 14px;border:1px solid var(--line);border-radius:12px;font:inherit}
  .row2{display:grid;grid-template-columns:1fr 160px;gap:10px}
  .chips{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  .chip{font-size:13px;padding:6px 10px;border-radius:999px;border:1px solid var(--line);background:var(--chip);cursor:pointer}
  .hint{font-size:12px;color:#64748b;margin-top:6px}

  /* Results */
  #results .nums{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:8px}
  @media(min-width:680px){ #results .nums{grid-template-columns:repeat(4,1fr)} }
  .stat{border:1px solid var(--line);border-radius:12px;padding:10px;background:#fff}
  .stat .lbl{font-size:12px;color:#64748b}
  .stat .val{font-size:20px;font-weight:800}

  .chart-wrap{margin-top:12px;display:grid;gap:10px}
  .canvas-row{display:grid;grid-template-columns:1fr;gap:12px}
  @media(min-width:760px){ .canvas-row{grid-template-columns:320px 1fr} }
  canvas{width:100%;height:auto;max-width:320px;border-radius:16px;border:1px solid var(--line);background:#fff}

  .legend{display:grid;gap:8px}
  .legend .item{display:flex;align-items:center;gap:8px}
  .legend .swatch{width:12px;height:12px;border-radius:3px;border:1px solid rgba(0,0,0,.1)}
  .edu{border:1px dashed var(--line);border-radius:12px;padding:10px;background:#fff;line-height:1.6}

  footer{margin-top:28px;text-align:center;color:#64748b}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="brand">
      <div class="logo">CA</div>
      <div>
        <h1>å¡è·¯é‡Œç†±é‡åˆ†æå™¨</h1>
        <small class="muted">è¼¸å…¥é£Ÿç‰©åç¨±æˆ–ä»½é‡ï¼Œç«‹å³å–å¾—ç†±é‡èˆ‡ç‡Ÿé¤Šç´ åœ–è¡¨</small>
      </div>
    </div>
  </header>

  <nav class="top-nav" aria-label="ä¸»è¦å°è¦½">
    <a href="#hero">é¦–é </a>
    <a href="#analyzer">åˆ†æå™¨</a>
    <a href="#value-prop">ç‰¹è‰²</a>
  </nav>

  <!-- 1) Hero Section -->
  <section id="hero" aria-labelledby="hero-title">
    <h2 id="hero-title">è¶…è¶Šæ•¸å­—ï¼Œå¥åº·éš¨å¿ƒ</h2>
    <p>ä½ çš„æ™ºæ…§ç†±é‡æŒ‡å—ï¼Œæ·±å…¥äº†è§£é£Ÿç‰©çš„çœŸæ­£åƒ¹å€¼ã€‚</p>
    <div class="actions">
      <a class="btn primary" href="#analyzer" aria-label="å‰å¾€åˆ†æå™¨">é–‹å§‹åˆ†æ</a>
      <a class="btn" href="#value-prop">ç­è§£ç‰¹è‰²</a>
    </div>
  </section>

  <!-- 2) Value Proposition -->
  <section id="value-prop" aria-labelledby="vp-title">
    <h3 id="vp-title">æˆ‘å€‘çš„åƒ¹å€¼ä¸»å¼µ</h3>
    <div class="vp-grid">
      <div class="vp">
        <div class="ico">ğŸ“Š</div>
        <strong>ä¸åªæ˜¯ç†±é‡</strong>
        <div class="muted">é™¤äº†ç¸½ç†±é‡ï¼Œæˆ‘å€‘æ›´æ·±å…¥åˆ†æè›‹ç™½è³ªã€ç¢³æ°´ã€è„‚è‚ªèˆ‡çº–ç¶­ã€‚</div>
      </div>
      <div class="vp">
        <div class="ico">ğŸ§ </div>
        <strong>ç‚ºä½ é‡èº«æ‰“é€ </strong>
        <div class="muted">å¯æ“´å……å€‹äººåŒ–ç›®æ¨™ï¼Œæä¾›æ›´è²¼è¿‘éœ€æ±‚çš„é£²é£Ÿå»ºè­°ã€‚</div>
      </div>
      <div class="vp">
        <div class="ico">âš¡</div>
        <strong>å³æ™‚å›é¥‹</strong>
        <div class="muted">è¼¸å…¥å³å¾—çµæœï¼Œä¸¦é™„å¸¶æ¸…æ¥šçš„åœ–è¡¨èˆ‡å»ºè­°æ–‡å­—ã€‚</div>
      </div>
      <div class="vp">
        <div class="ico">ğŸ§©</div>
        <strong>æ˜“æ–¼æ•´åˆ</strong>
        <div class="muted">å–®æª”éƒ¨ç½²ï¼Œæœªä¾†å¯ç›´æ¥æ¥ä¸Šå®˜æ–¹ API æˆ–è‡ªå®¶å¾Œç«¯ã€‚</div>
      </div>
    </div>
  </section>

  <!-- 3) Analyzer (æ ¸å¿ƒåŠŸèƒ½) -->
  <section id="analyzer" aria-labelledby="analyzer-title">
    <h3 id="analyzer-title" style="margin:0 0 10px">åˆ†æå™¨</h3>
    <div class="card">
      <div class="grid">
        <div>
          <label for="q">é£Ÿç‰©åç¨±æˆ–æè¿°</label>
          <div class="row2" style="margin-top:6px">
            <input id="q" type="text" placeholder="ä¾‹å¦‚ï¼šé¦™è•‰ 1 æ ¹ / é›èƒ¸è‚‰ 120g / ç™½é£¯ 150g" autocomplete="off" />
            <button id="btnAnalyze" class="btn primary" aria-label="é–‹å§‹åˆ†æ">é–‹å§‹åˆ†æ</button>
          </div>
          <div class="chips" aria-label="å¿«é€Ÿç¯„ä¾‹">
            <span class="chip" data-example="é¦™è•‰ 1 æ ¹">é¦™è•‰ 1 æ ¹</span>
            <span class="chip" data-example="é›èƒ¸è‚‰ 120g">é›èƒ¸è‚‰ 120g</span>
            <span class="chip" data-example="ç™½é£¯ 150g">ç™½é£¯ 150g</span>
            <span class="chip" data-example="70% é»‘å·§å…‹åŠ› 20g">70% é»‘å·§å…‹åŠ› 20g</span>
            <span class="chip" data-example="è±†è… 100g">è±†è… 100g</span>
          </div>
          <p class="hint">æç¤ºï¼šä»¥ä¸‹çµæœç‚ºç¤ºæ„ç”¨é€”çš„æœ¬åœ°æ¨¡æ“¬ï¼Œæ­£å¼ç‰ˆå¯ä¸²æ¥çœŸå¯¦ç‡Ÿé¤Šè³‡æ–™ APIã€‚</p>
        </div>

        <div id="results" aria-live="polite">
          <div class="muted" id="placeholder">è«‹è¼¸å…¥é£Ÿç‰©ä¸¦æŒ‰ã€Œé–‹å§‹åˆ†æã€ã€‚</div>
        </div>
      </div>
    </div>
  </section>

  <footer>
    <p>Â© 2025 Calorie Analyzer. All rights reserved.</p>
  </footer>
</div>

<script>
/* =========================
   æ¨¡æ“¬è³‡æ–™ï¼‹å•†æ¥­é‚è¼¯
   ========================= */

const MOCK_DB = [
  { keys:['é¦™è•‰','banana'], base: { per:'1 æ ¹(ä¸­) ~118g', calories_kcal:105, protein_g:1.3, carbs_g:27, fats_g:0.3, fiber_g:3.1 } },
  { keys:['ç™½é£¯','ç±³é£¯','rice'], base: { per:'100g ç†Ÿ', calories_kcal:130, protein_g:2.4, carbs_g:28, fats_g:0.3, fiber_g:0.4 } },
  { keys:['é›èƒ¸è‚‰','chicken breast'], base: { per:'100g ç†Ÿ', calories_kcal:165, protein_g:31, carbs_g:0, fats_g:3.6, fiber_g:0 } },
  { keys:['è±†è…','tofu'], base: { per:'100g', calories_kcal:76, protein_g:8, carbs_g:2, fats_g:4.8, fiber_g:0.3 } },
  { keys:['ç‡•éº¥','oatmeal'], base: { per:'40g ä¹¾', calories_kcal:150, protein_g:5, carbs_g:27, fats_g:3, fiber_g:4 } },
  { keys:['é»‘å·§å…‹åŠ›','70% é»‘å·§å…‹åŠ›','dark chocolate'], base: { per:'20g', calories_kcal:120, protein_g:1.9, carbs_g:8, fats_g:9, fiber_g:2.3 } },
  { keys:['é®ªé­š','tuna'], base: { per:'100g æ°´æµ¸ç½', calories_kcal:132, protein_g:29, carbs_g:0, fats_g:0.6, fiber_g:0 } },
];

function parseAmountInGram(q){
  const m = q.match(/(\d+(?:\.\d+)?)\s*(g|å…¬å…‹)/i);
  return m ? parseFloat(m[1]) : null;
}
function findFood(q){
  const s = q.toLowerCase();
  for(const item of MOCK_DB){
    if(item.keys.some(k=>s.includes(k.toLowerCase()))) return item;
  }
  return null;
}

/** analyzeFoodï¼šå›å‚³åŒ…å«ç†±é‡èˆ‡å››é …ç‡Ÿé¤Šç´ çš„ JSON
 *  { name, serving_desc, calories_kcal, protein_g, carbs_g, fats_g, fiber_g }
 */
function analyzeFood(query){
  const q = (query || '').trim();
  if(!q) return Promise.reject(new Error('è«‹è¼¸å…¥é£Ÿç‰©åç¨±æˆ–æè¿°'));

  const match = findFood(q);
  const gram = parseAmountInGram(q);
  const scale = (basePerGram) => (gram ? (gram / basePerGram) : 1);

  return new Promise((resolve)=>{
    setTimeout(()=>{
      if(match){
        const base = match.base;
        let baseGram = 100;
        const gm = base.per.match(/~?\s*(\d+)\s*g/i);
        if(gm) baseGram = parseFloat(gm[1]);

        const k = scale(baseGram);
        resolve({
          name: match.keys[0],
          serving_desc: gram ? `${gram}gï¼ˆä¼°ç®—ï¼‰` : base.per,
          calories_kcal: +(base.calories_kcal * k).toFixed(0),
          protein_g: +(base.protein_g * k).toFixed(1),
          carbs_g: +(base.carbs_g * k).toFixed(1),
          fats_g: +(base.fats_g * k).toFixed(1),
          fiber_g: +(base.fiber_g * k).toFixed(1),
          _source: 'mock-db'
        });
      } else {
        // æ‰¾ä¸åˆ°ï¼šçµ¦ä¸€å€‹ä¸­æ€§ä¼°ç®—ï¼ˆæ¯ 100g ç´„ 160 kcalã€P/C/F = 20/50/30ï¼‰
        const g = gram || 100;
        const kcalPer100 = 160;
        const kcal = Math.round(kcalPer100 * (g/100));
        const protein = +((kcal*0.20)/4).toFixed(1);
        const carbs   = +((kcal*0.50)/4).toFixed(1);
        const fats    = +((kcal*0.30)/9).toFixed(1);
        const fiber   = +(Math.max(0, (g/100)*2)).toFixed(1);
        resolve({
          name: q,
          serving_desc: `${g}gï¼ˆä¼°ç®—ï¼‰`,
          calories_kcal: kcal,
          protein_g: protein,
          carbs_g: carbs,
          fats_g: fats,
          fiber_g: fiber,
          _source: 'heuristic'
        });
      }
    }, 500);
  });
}

/* =========================
   è¦–è¦ºåŒ– (Canvas åœ“é¤…åœ–)
   ========================= */
const COLORS = { protein:'#10b981', carbs:'#f59e0b', fats:'#ef4444' };

function drawPie(canvas, numbers){
  if(!canvas) return;
  const ctx = canvas.getContext('2d');
  const dpr = window.devicePixelRatio || 1;
  const size = Math.min(canvas.clientWidth || 320, 320);
  const pad = 8;
  const W = size, H = size;
  canvas.width = W * dpr; canvas.height = H * dpr;
  canvas.style.width = W+'px'; canvas.style.height = H+'px';
  ctx.scale(dpr,dpr);
  ctx.clearRect(0,0,W,H);

  const cx=W/2, cy=H/2, r=Math.min(W,H)/2 - pad;
  const total = Math.max(1, numbers.protein + numbers.carbs + numbers.fats);
  const slices = [
    {value:numbers.protein, color:COLORS.protein},
    {value:numbers.carbs,   color:COLORS.carbs},
    {value:numbers.fats,    color:COLORS.fats},
  ];
  let start = -Math.PI/2;
  for(const s of slices){
    const ang = (s.value/total)*Math.PI*2;
    ctx.beginPath();
    ctx.moveTo(cx,cy);
    ctx.arc(cx,cy,r,start,start+ang);
    ctx.closePath();
    ctx.fillStyle=s.color;
    ctx.fill();
    start += ang;
  }
  // ç”œç”œåœˆä¸­ç©º
  ctx.globalCompositeOperation='destination-out';
  ctx.beginPath(); ctx.arc(cx,cy,r*0.55,0,Math.PI*2); ctx.fill();
  ctx.globalCompositeOperation='source-over';
  // é‚Šæ¡†
  ctx.beginPath(); ctx.arc(cx,cy,r,0,Math.PI*2); ctx.lineWidth=1; ctx.strokeStyle='rgba(0,0,0,.08)'; ctx.stroke();
}

function buildInsight(r){
  const kcalFrom = { protein:r.protein_g*4, carbs:r.carbs_g*4, fats:r.fats_g*9 };
  const total = Math.max(1, kcalFrom.protein + kcalFrom.carbs + kcalFrom.fats);
  const pct = {
    protein: Math.round(kcalFrom.protein/total*100),
    carbs:   Math.round(kcalFrom.carbs/total*100),
    fats:    Math.round(kcalFrom.fats/total*100)
  };
  if(pct.carbs >= 50) return 'é€™ä»½é£Ÿç‰©çš„ç†±é‡ä¸»è¦ä¾†è‡ªç¢³æ°´åŒ–åˆç‰©ï¼Œå»ºè­°æ­é…å¯Œå«è›‹ç™½è³ªçš„é£Ÿç‰©ï¼ˆå¦‚é›èƒ¸è‚‰ã€è±†è…ï¼‰ï¼Œä»¥ç¶­æŒé£½è¶³èˆ‡ç©©å®šèƒ½é‡ã€‚';
  if(pct.fats >= 45)  return 'æ­¤é£Ÿç‰©è„‚è‚ªå æ¯”åé«˜ï¼Œè«‹ç•™æ„ä»½é‡ä¸¦åŠ å…¥é«˜çº–è”¬èœèˆ‡å„ªè³ªè›‹ç™½è³ªï¼Œæå‡é¤é»ç‡Ÿé¤Šå¯†åº¦ã€‚';
  if(pct.protein >= 35) return 'è›‹ç™½è³ªæ¯”ä¾‹è¼ƒé«˜ï¼Œé©åˆä½œç‚ºä¸»é«”é£Ÿæï¼›è¨˜å¾—è£œè¶³å„ªè³ªç¢³æ°´èˆ‡çº–ç¶­æ›´å‡è¡¡ã€‚';
  return 'ç‡Ÿé¤Šç´ æ¯”ä¾‹ç›¸å°å‡è¡¡ï¼Œå¯ä¾å€‹äººç›®æ¨™å¾®èª¿è›‹ç™½è³ªèˆ‡çº–ç¶­çš„æ”å–é‡ã€‚';
}

/* =========================
   UI ç¶å®šèˆ‡æ¸²æŸ“
   ========================= */
const els = {
  q: document.getElementById('q'),
  btn: document.getElementById('btnAnalyze'),
  results: document.getElementById('results'),
};

function escapeHtml(str){
  return String(str).replace(/[&<>"']/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[s]));
}
function renderLoading(){
  els.results.innerHTML = `
    <div class="muted">åˆ†æä¸­â€¦</div>
    <div class="nums" style="opacity:.6">
      <div class="stat"><div class="lbl">ç†±é‡</div><div class="val">â€”</div></div>
      <div class="stat"><div class="lbl">è›‹ç™½è³ª</div><div class="val">â€”</div></div>
      <div class="stat"><div class="lbl">ç¢³æ°´</div><div class="val">â€”</div></div>
      <div class="stat"><div class="lbl">è„‚è‚ª</div><div class="val">â€”</div></div>
    </div>
  `;
}
function renderResult(r){
  els.results.innerHTML = `
    <div><strong>${escapeHtml(r.name)}</strong> Â· <span class="muted">${escapeHtml(r.serving_desc)}</span></div>
    <div class="nums">
      <div class="stat"><div class="lbl">ç†±é‡</div><div class="val">${r.calories_kcal} kcal</div></div>
      <div class="stat"><div class="lbl">è›‹ç™½è³ª</div><div class="val">${r.protein_g} g</div></div>
      <div class="stat"><div class="lbl">ç¢³æ°´</div><div class="val">${r.carbs_g} g</div></div>
      <div class="stat"><div class="lbl">è„‚è‚ª</div><div class="val">${r.fats_g} g</div></div>
    </div>

    <div class="chart-wrap">
      <div class="canvas-row">
        <canvas id="pie" width="320" height="320" aria-label="ç‡Ÿé¤Šç´ æ¯”ä¾‹åœ“é¤…åœ–" role="img"></canvas>
        <div>
          <div class="legend">
            <div class="item"><span class="swatch" style="background:${COLORS.protein}"></span>è›‹ç™½è³ªï¼š<strong>${r.protein_g} g</strong></div>
            <div class="item"><span class="swatch" style="background:${COLORS.carbs}"></span>ç¢³æ°´åŒ–åˆç‰©ï¼š<strong>${r.carbs_g} g</strong></div>
            <div class="item"><span class="swatch" style="background:${COLORS.fats}"></span>è„‚è‚ªï¼š<strong>${r.fats_g} g</strong></div>
            <div class="item" style="opacity:.85">è†³é£Ÿçº–ç¶­ï¼š<strong>${r.fiber_g} g</strong></div>
          </div>
          <div class="edu" id="edu" style="margin-top:10px"></div>
        </div>
      </div>
    </div>
  `;
  document.getElementById('edu').textContent = buildInsight(r);
  const canvas = document.getElementById('pie');
  drawPie(canvas, { protein:r.protein_g, carbs:r.carbs_g, fats:r.fats_g });

  // è¦–çª—ç¸®æ”¾æ™‚é‡ç¹ªï¼Œé¿å…æ¨¡ç³Š
  let resizeTimer;
  window.addEventListener('resize', ()=>{
    clearTimeout(resizeTimer);
    resizeTimer = setTimeout(()=>drawPie(canvas, { protein:r.protein_g, carbs:r.carbs_g, fats:r.fats_g }), 120);
  }, { passive:true });
}

function runAnalyze(){
  const q = els.q.value.trim();
  if(!q){
    els.results.innerHTML = `<div class="muted">è«‹å…ˆè¼¸å…¥è¦åˆ†æçš„é£Ÿç‰©ã€‚</div>`;
    return;
  }
  renderLoading();
  analyzeFood(q).then(renderResult).catch(err=>{
    els.results.innerHTML = `<div class="muted">ç„¡æ³•åˆ†æï¼š${escapeHtml(err.message||'æœªçŸ¥éŒ¯èª¤')}</div>`;
  });
}

/* ç¶å®šäº‹ä»¶èˆ‡å¿«é€Ÿç¯„ä¾‹ */
els.btn.addEventListener('click', runAnalyze);
els.q.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ runAnalyze(); } });
document.querySelectorAll('.chip').forEach(ch=>{
  ch.addEventListener('click', ()=>{
    els.q.value = ch.getAttribute('data-example') || ch.textContent.trim();
    runAnalyze();
  });
});
</script>
</body>
</html>
