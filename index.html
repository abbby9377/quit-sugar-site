<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>卡路里熱量分析器｜Calorie Analyzer</title>
<meta name="description" content="你的智慧熱量指南：輸入食物即可得到熱量與營養素比例，並附上圖表與建議。"/>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;600;700;800&display=swap" rel="stylesheet">

<style>
  :root{
    --bg:#ffffff; --text:#0f172a; --muted:#475569; --line:#e5e7eb;
    --brand:#ec4899; --brand-2:#f472b6; --brand-3:#fb7185;
    --accent:#fdf2f8; --chip:#eef2ff;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; background:var(--bg); color:var(--text);
    font-family:'Noto Sans TC',system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    -webkit-font-smoothing:antialiased; line-height:1.55;
  }
  .wrap{max-width:1024px;margin:0 auto;padding:28px 18px 80px}

  header{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
  .brand{display:flex;gap:12px;align-items:center}
  .logo{width:42px;height:42px;border-radius:12px;display:grid;place-items:center;color:#fff;font-weight:900;
        background:linear-gradient(135deg,var(--brand-2),var(--brand-3))}
  h1{margin:0;font-size:22px}
  small.muted{color:var(--muted)}

  /* nav */
  .top-nav{display:flex;gap:14px;align-items:center;padding:10px 0 16px;margin:0 0 16px;border-bottom:1px solid var(--line)}
  .top-nav a{color:#2563eb;text-decoration:none}
  .top-nav a:hover{text-decoration:underline}

  /* Hero */
  #hero{
    margin:6px 0 22px; padding:34px 20px;
    background:linear-gradient(135deg,var(--accent),#fff);
    border:1px solid var(--line); border-radius:26px;
  }
  #hero h2{margin:0 0 10px; font-size:36px; line-height:1.2}
  #hero p{margin:0; color:var(--muted); font-size:18px}
  #hero .actions{margin-top:16px; display:flex; gap:10px; flex-wrap:wrap}
  .btn{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--line);
       padding:12px 16px;border-radius:999px;background:#f8fafc;color:var(--text);cursor:pointer}
  .btn.primary{background:linear-gradient(135deg,var(--brand-2),var(--brand));color:#fff;border:none;font-weight:800}

  /* Value Proposition */
  #value-prop{margin:6px 0 24px}
  #value-prop h3{margin:0 0 12px; font-size:20px}
  .vp-grid{display:grid; gap:12px}
  @media(min-width:760px){ .vp-grid{grid-template-columns:repeat(4,1fr)} }
  .vp{border:1px solid var(--line); border-radius:16px; padding:14px; background:#fff}
  .vp .ico{width:36px;height:36px;border-radius:10px;display:grid;place-items:center;margin-bottom:6px;
           background:linear-gradient(135deg,#fde68a,#fca5a5)}
  .vp strong{display:block;margin-bottom:4px}
  .muted{color:var(--muted)}

  /* Analyzer */
  #analyzer{margin:10px 0 24px}
  .card{background:#fff;border:1px solid var(--line);border-radius:18px;padding:16px}
  .grid{display:grid; gap:14px}
  @media(min-width:900px){ .grid{grid-template-columns:1.2fr 1fr} }
  label{font-weight:700;font-size:14px}
  input[type=text]{width:100%;padding:12px 14px;border:1px solid var(--line);border-radius:12px;font:inherit}
  .row2{display:grid;grid-template-columns:1fr 160px;gap:10px}
  .chips{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  .chip{font-size:13px;padding:6px 10px;border-radius:999px;border:1px solid var(--line);background:var(--chip);cursor:pointer}
  .hint{font-size:12px;color:#64748b;margin-top:6px}

  /* Results */
  #results .nums{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:8px}
  @media(min-width:680px){ #results .nums{grid-template-columns:repeat(4,1fr)} }
  .stat{border:1px solid var(--line);border-radius:12px;padding:10px;background:#fff}
  .stat .lbl{font-size:12px;color:#64748b}
  .stat .val{font-size:20px;font-weight:800}

  .chart-wrap{margin-top:12px;display:grid;gap:10px}
  .canvas-row{display:grid;grid-template-columns:1fr;gap:12px}
  @media(min-width:760px){ .canvas-row{grid-template-columns:320px 1fr} }
  canvas{width:100%;height:auto;max-width:320px;border-radius:16px;border:1px solid var(--line);background:#fff}

  .legend{display:grid;gap:8px}
  .legend .item{display:flex;align-items:center;gap:8px}
  .legend .swatch{width:12px;height:12px;border-radius:3px;border:1px solid rgba(0,0,0,.1)}
  .edu{border:1px dashed var(--line);border-radius:12px;padding:10px;background:#fff;line-height:1.6}

  footer{margin-top:28px;text-align:center;color:#64748b}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="brand">
      <div class="logo">CA</div>
      <div>
        <h1>卡路里熱量分析器</h1>
        <small class="muted">輸入食物名稱或份量，立即取得熱量與營養素圖表</small>
      </div>
    </div>
  </header>

  <nav class="top-nav" aria-label="主要導覽">
    <a href="#hero">首頁</a>
    <a href="#analyzer">分析器</a>
    <a href="#value-prop">特色</a>
  </nav>

  <!-- 1) Hero Section -->
  <section id="hero" aria-labelledby="hero-title">
    <h2 id="hero-title">超越數字，健康隨心</h2>
    <p>你的智慧熱量指南，深入了解食物的真正價值。</p>
    <div class="actions">
      <a class="btn primary" href="#analyzer" aria-label="前往分析器">開始分析</a>
      <a class="btn" href="#value-prop">瞭解特色</a>
    </div>
  </section>

  <!-- 2) Value Proposition -->
  <section id="value-prop" aria-labelledby="vp-title">
    <h3 id="vp-title">我們的價值主張</h3>
    <div class="vp-grid">
      <div class="vp">
        <div class="ico">📊</div>
        <strong>不只是熱量</strong>
        <div class="muted">除了總熱量，我們更深入分析蛋白質、碳水、脂肪與纖維。</div>
      </div>
      <div class="vp">
        <div class="ico">🧠</div>
        <strong>為你量身打造</strong>
        <div class="muted">可擴充個人化目標，提供更貼近需求的飲食建議。</div>
      </div>
      <div class="vp">
        <div class="ico">⚡</div>
        <strong>即時回饋</strong>
        <div class="muted">輸入即得結果，並附帶清楚的圖表與建議文字。</div>
      </div>
      <div class="vp">
        <div class="ico">🧩</div>
        <strong>易於整合</strong>
        <div class="muted">單檔部署，未來可直接接上官方 API 或自家後端。</div>
      </div>
    </div>
  </section>

  <!-- 3) Analyzer (核心功能) -->
  <section id="analyzer" aria-labelledby="analyzer-title">
    <h3 id="analyzer-title" style="margin:0 0 10px">分析器</h3>
    <div class="card">
      <div class="grid">
        <div>
          <label for="q">食物名稱或描述</label>
          <div class="row2" style="margin-top:6px">
            <input id="q" type="text" placeholder="例如：香蕉 1 根 / 雞胸肉 120g / 白飯 150g" autocomplete="off" />
            <button id="btnAnalyze" class="btn primary" aria-label="開始分析">開始分析</button>
          </div>
          <div class="chips" aria-label="快速範例">
            <span class="chip" data-example="香蕉 1 根">香蕉 1 根</span>
            <span class="chip" data-example="雞胸肉 120g">雞胸肉 120g</span>
            <span class="chip" data-example="白飯 150g">白飯 150g</span>
            <span class="chip" data-example="70% 黑巧克力 20g">70% 黑巧克力 20g</span>
            <span class="chip" data-example="豆腐 100g">豆腐 100g</span>
          </div>
          <p class="hint">提示：以下結果為示意用途的本地模擬，正式版可串接真實營養資料 API。</p>
        </div>

        <div id="results" aria-live="polite">
          <div class="muted" id="placeholder">請輸入食物並按「開始分析」。</div>
        </div>
      </div>
    </div>
  </section>

  <footer>
    <p>© 2025 Calorie Analyzer. All rights reserved.</p>
  </footer>
</div>

<script>
/* =========================
   模擬資料＋商業邏輯
   ========================= */

const MOCK_DB = [
  { keys:['香蕉','banana'], base: { per:'1 根(中) ~118g', calories_kcal:105, protein_g:1.3, carbs_g:27, fats_g:0.3, fiber_g:3.1 } },
  { keys:['白飯','米飯','rice'], base: { per:'100g 熟', calories_kcal:130, protein_g:2.4, carbs_g:28, fats_g:0.3, fiber_g:0.4 } },
  { keys:['雞胸肉','chicken breast'], base: { per:'100g 熟', calories_kcal:165, protein_g:31, carbs_g:0, fats_g:3.6, fiber_g:0 } },
  { keys:['豆腐','tofu'], base: { per:'100g', calories_kcal:76, protein_g:8, carbs_g:2, fats_g:4.8, fiber_g:0.3 } },
  { keys:['燕麥','oatmeal'], base: { per:'40g 乾', calories_kcal:150, protein_g:5, carbs_g:27, fats_g:3, fiber_g:4 } },
  { keys:['黑巧克力','70% 黑巧克力','dark chocolate'], base: { per:'20g', calories_kcal:120, protein_g:1.9, carbs_g:8, fats_g:9, fiber_g:2.3 } },
  { keys:['鮪魚','tuna'], base: { per:'100g 水浸罐', calories_kcal:132, protein_g:29, carbs_g:0, fats_g:0.6, fiber_g:0 } },
];

function parseAmountInGram(q){
  const m = q.match(/(\d+(?:\.\d+)?)\s*(g|公克)/i);
  return m ? parseFloat(m[1]) : null;
}
function findFood(q){
  const s = q.toLowerCase();
  for(const item of MOCK_DB){
    if(item.keys.some(k=>s.includes(k.toLowerCase()))) return item;
  }
  return null;
}

/** analyzeFood：回傳包含熱量與四項營養素的 JSON
 *  { name, serving_desc, calories_kcal, protein_g, carbs_g, fats_g, fiber_g }
 */
function analyzeFood(query){
  const q = (query || '').trim();
  if(!q) return Promise.reject(new Error('請輸入食物名稱或描述'));

  const match = findFood(q);
  const gram = parseAmountInGram(q);
  const scale = (basePerGram) => (gram ? (gram / basePerGram) : 1);

  return new Promise((resolve)=>{
    setTimeout(()=>{
      if(match){
        const base = match.base;
        let baseGram = 100;
        const gm = base.per.match(/~?\s*(\d+)\s*g/i);
        if(gm) baseGram = parseFloat(gm[1]);

        const k = scale(baseGram);
        resolve({
          name: match.keys[0],
          serving_desc: gram ? `${gram}g（估算）` : base.per,
          calories_kcal: +(base.calories_kcal * k).toFixed(0),
          protein_g: +(base.protein_g * k).toFixed(1),
          carbs_g: +(base.carbs_g * k).toFixed(1),
          fats_g: +(base.fats_g * k).toFixed(1),
          fiber_g: +(base.fiber_g * k).toFixed(1),
          _source: 'mock-db'
        });
      } else {
        // 找不到：給一個中性估算（每 100g 約 160 kcal、P/C/F = 20/50/30）
        const g = gram || 100;
        const kcalPer100 = 160;
        const kcal = Math.round(kcalPer100 * (g/100));
        const protein = +((kcal*0.20)/4).toFixed(1);
        const carbs   = +((kcal*0.50)/4).toFixed(1);
        const fats    = +((kcal*0.30)/9).toFixed(1);
        const fiber   = +(Math.max(0, (g/100)*2)).toFixed(1);
        resolve({
          name: q,
          serving_desc: `${g}g（估算）`,
          calories_kcal: kcal,
          protein_g: protein,
          carbs_g: carbs,
          fats_g: fats,
          fiber_g: fiber,
          _source: 'heuristic'
        });
      }
    }, 500);
  });
}

/* =========================
   視覺化 (Canvas 圓餅圖)
   ========================= */
const COLORS = { protein:'#10b981', carbs:'#f59e0b', fats:'#ef4444' };

function drawPie(canvas, numbers){
  if(!canvas) return;
  const ctx = canvas.getContext('2d');
  const dpr = window.devicePixelRatio || 1;
  const size = Math.min(canvas.clientWidth || 320, 320);
  const pad = 8;
  const W = size, H = size;
  canvas.width = W * dpr; canvas.height = H * dpr;
  canvas.style.width = W+'px'; canvas.style.height = H+'px';
  ctx.scale(dpr,dpr);
  ctx.clearRect(0,0,W,H);

  const cx=W/2, cy=H/2, r=Math.min(W,H)/2 - pad;
  const total = Math.max(1, numbers.protein + numbers.carbs + numbers.fats);
  const slices = [
    {value:numbers.protein, color:COLORS.protein},
    {value:numbers.carbs,   color:COLORS.carbs},
    {value:numbers.fats,    color:COLORS.fats},
  ];
  let start = -Math.PI/2;
  for(const s of slices){
    const ang = (s.value/total)*Math.PI*2;
    ctx.beginPath();
    ctx.moveTo(cx,cy);
    ctx.arc(cx,cy,r,start,start+ang);
    ctx.closePath();
    ctx.fillStyle=s.color;
    ctx.fill();
    start += ang;
  }
  // 甜甜圈中空
  ctx.globalCompositeOperation='destination-out';
  ctx.beginPath(); ctx.arc(cx,cy,r*0.55,0,Math.PI*2); ctx.fill();
  ctx.globalCompositeOperation='source-over';
  // 邊框
  ctx.beginPath(); ctx.arc(cx,cy,r,0,Math.PI*2); ctx.lineWidth=1; ctx.strokeStyle='rgba(0,0,0,.08)'; ctx.stroke();
}

function buildInsight(r){
  const kcalFrom = { protein:r.protein_g*4, carbs:r.carbs_g*4, fats:r.fats_g*9 };
  const total = Math.max(1, kcalFrom.protein + kcalFrom.carbs + kcalFrom.fats);
  const pct = {
    protein: Math.round(kcalFrom.protein/total*100),
    carbs:   Math.round(kcalFrom.carbs/total*100),
    fats:    Math.round(kcalFrom.fats/total*100)
  };
  if(pct.carbs >= 50) return '這份食物的熱量主要來自碳水化合物，建議搭配富含蛋白質的食物（如雞胸肉、豆腐），以維持飽足與穩定能量。';
  if(pct.fats >= 45)  return '此食物脂肪占比偏高，請留意份量並加入高纖蔬菜與優質蛋白質，提升餐點營養密度。';
  if(pct.protein >= 35) return '蛋白質比例較高，適合作為主體食材；記得補足優質碳水與纖維更均衡。';
  return '營養素比例相對均衡，可依個人目標微調蛋白質與纖維的攝取量。';
}

/* =========================
   UI 綁定與渲染
   ========================= */
const els = {
  q: document.getElementById('q'),
  btn: document.getElementById('btnAnalyze'),
  results: document.getElementById('results'),
};

function escapeHtml(str){
  return String(str).replace(/[&<>"']/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[s]));
}
function renderLoading(){
  els.results.innerHTML = `
    <div class="muted">分析中…</div>
    <div class="nums" style="opacity:.6">
      <div class="stat"><div class="lbl">熱量</div><div class="val">—</div></div>
      <div class="stat"><div class="lbl">蛋白質</div><div class="val">—</div></div>
      <div class="stat"><div class="lbl">碳水</div><div class="val">—</div></div>
      <div class="stat"><div class="lbl">脂肪</div><div class="val">—</div></div>
    </div>
  `;
}
function renderResult(r){
  els.results.innerHTML = `
    <div><strong>${escapeHtml(r.name)}</strong> · <span class="muted">${escapeHtml(r.serving_desc)}</span></div>
    <div class="nums">
      <div class="stat"><div class="lbl">熱量</div><div class="val">${r.calories_kcal} kcal</div></div>
      <div class="stat"><div class="lbl">蛋白質</div><div class="val">${r.protein_g} g</div></div>
      <div class="stat"><div class="lbl">碳水</div><div class="val">${r.carbs_g} g</div></div>
      <div class="stat"><div class="lbl">脂肪</div><div class="val">${r.fats_g} g</div></div>
    </div>

    <div class="chart-wrap">
      <div class="canvas-row">
        <canvas id="pie" width="320" height="320" aria-label="營養素比例圓餅圖" role="img"></canvas>
        <div>
          <div class="legend">
            <div class="item"><span class="swatch" style="background:${COLORS.protein}"></span>蛋白質：<strong>${r.protein_g} g</strong></div>
            <div class="item"><span class="swatch" style="background:${COLORS.carbs}"></span>碳水化合物：<strong>${r.carbs_g} g</strong></div>
            <div class="item"><span class="swatch" style="background:${COLORS.fats}"></span>脂肪：<strong>${r.fats_g} g</strong></div>
            <div class="item" style="opacity:.85">膳食纖維：<strong>${r.fiber_g} g</strong></div>
          </div>
          <div class="edu" id="edu" style="margin-top:10px"></div>
        </div>
      </div>
    </div>
  `;
  document.getElementById('edu').textContent = buildInsight(r);
  const canvas = document.getElementById('pie');
  drawPie(canvas, { protein:r.protein_g, carbs:r.carbs_g, fats:r.fats_g });

  // 視窗縮放時重繪，避免模糊
  let resizeTimer;
  window.addEventListener('resize', ()=>{
    clearTimeout(resizeTimer);
    resizeTimer = setTimeout(()=>drawPie(canvas, { protein:r.protein_g, carbs:r.carbs_g, fats:r.fats_g }), 120);
  }, { passive:true });
}

function runAnalyze(){
  const q = els.q.value.trim();
  if(!q){
    els.results.innerHTML = `<div class="muted">請先輸入要分析的食物。</div>`;
    return;
  }
  renderLoading();
  analyzeFood(q).then(renderResult).catch(err=>{
    els.results.innerHTML = `<div class="muted">無法分析：${escapeHtml(err.message||'未知錯誤')}</div>`;
  });
}

/* 綁定事件與快速範例 */
els.btn.addEventListener('click', runAnalyze);
els.q.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ runAnalyze(); } });
document.querySelectorAll('.chip').forEach(ch=>{
  ch.addEventListener('click', ()=>{
    els.q.value = ch.getAttribute('data-example') || ch.textContent.trim();
    runAnalyze();
  });
});
</script>
</body>
</html>
