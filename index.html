<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>æˆ’ç³–è¨ˆç•«ï½œQuit Sugar</title>
  <meta name="description" content="ç°¡å–®é–‹å§‹çš„æˆ’ç³–ç¶²ç«™ï¼šè¨»å†Šç™»å…¥ã€è¿½è¹¤é€£å‹ã€å¥åº·è¡Œå‹•æ¸…å–®èˆ‡æ¯æ—¥æ¿€å‹µã€‚" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
  /* ===== è¦–è¦ºä¸»é¡Œï¼ˆå¥³æ€§å‹å–„ã€æŸ”å’Œè‰²èª¿ï¼‰ ===== */
  :root {
    --bg:#ffffff; --card:#ffffff; --muted:#475569; --text:#0f172a;
    --brand:#ec4899; --brand-2:#f472b6; --brand-3:#fb7185;
    --accent:#fdf2f8; --line:#e5e7eb; --danger:#ef4444;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font-family:'Noto Sans TC',system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;}
  .wrap{max-width:980px;margin:0 auto;padding:32px 20px 80px}
  header{display:flex;gap:16px;align-items:center;justify-content:space-between;margin-bottom:12px}
  .brand{display:flex;gap:12px;align-items:center}
  .logo{width:42px;height:42px;border-radius:12px;background:linear-gradient(135deg,var(--brand-2),var(--brand-3));display:grid;place-items:center;color:#fff;font-weight:900}
  h1{margin:0;font-size:24px;letter-spacing:0.5px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:18px;padding:18px;box-shadow:0 6px 20px rgba(236,72,153,.08)}
  .grid{display:grid;gap:16px}
  @media(min-width:960px){.grid{grid-template-columns:1.1fr 1fr}}
  h2{font-size:20px;margin:0 0 10px}
  h3{font-size:18px;margin:16px 0 8px}
  p,li,small{color:var(--muted)}
  input,button{font:inherit}
  input{width:100%;background:#fff;border:1px solid #d1d5db;padding:10px 12px;border-radius:12px;color:var(--text)}
  .row{display:grid;gap:10px}
  .row2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .btn{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--line);padding:12px 16px;border-radius:999px;background:#f8fafc;color:var(--text);cursor:pointer;white-space:nowrap}
  .btn.primary{background:linear-gradient(135deg,var(--brand-2),var(--brand));color:#fff;border:none;font-weight:700}
  .btn.ghost{background:transparent}
  .btn.danger{background:linear-gradient(135deg,#ef4444,#b91c1c);border:none;color:#fff}
  .stat{display:flex;gap:14px;align-items:center}
  .stat .num{font-size:28px;font-weight:800}
  .kicker{display:inline-block;padding:4px 10px;border-radius:999px;background:#fff;border:1px solid var(--line);color:var(--brand);font-size:12px;font-weight:700}
  .list{display:grid;gap:8px}
  .todo{display:flex;align-items:center;gap:10px}
  .todo input[type=checkbox]{width:18px;height:18px}
  .muted{color:var(--muted)}
  .error{border-left:3px solid var(--danger);padding:10px 12px;background:#fff5f5;border-radius:12px}
  footer{margin-top:28px;text-align:center;color:var(--muted)}
  code{background:#f1f5f9;padding:2px 6px;border-radius:6px;border:1px solid var(--line)}
  hr{border-color:var(--line)}
  nav.top-nav{display:flex;gap:16px;align-items:center;padding:8px 0 14px;margin:0 0 16px;border-bottom:1px solid var(--line)}
  nav.top-nav a{color:#2563eb;text-decoration:none}
  nav.top-nav a:hover{text-decoration:underline}

  /* ===== æ–°å¢ï¼šå‰¯å°è¦½ï¼ˆéŒ¨é»ï¼‰ ===== */
  .subnav{display:flex;gap:12px;flex-wrap:wrap;margin:8px 0 16px}
  .chip{padding:8px 12px;border:1px solid var(--line);border-radius:999px;background:#fff}
  .chip a{text-decoration:none;color:#334155}

  /* ===== Hero ===== */
  .hero{background:var(--accent);border:1px solid var(--line);border-radius:24px;padding:24px;margin:8px 0 22px;position:relative}
  .hero h2{font-size:28px;margin:0 0 8px;color:#0f172a}
  .hero p{margin:0 0 14px}
  .hero .actions{display:flex;gap:10px;flex-wrap:wrap}

  /* ===== äº®é» / åŠŸèƒ½ ===== */
  .section-title{font-size:18px;margin:18px 0 10px}
  .features{display:grid;gap:12px;margin:0 0 20px}
  @media(min-width:800px){.features{grid-template-columns:repeat(4,1fr)}}
  .feature{background:#ffffff;border:1px solid var(--line);border-radius:16px;padding:14px}
  .feature h4{margin:0 0 6px;font-size:15px}
  .icon{width:34px;height:34px;border-radius:10px;display:grid;place-items:center;margin-bottom:6px;background:linear-gradient(135deg,#fde68a,#fca5a5)}

  /* ===== ä¸‰æ­¥é©Ÿ ===== */
  .steps{display:grid;gap:12px;margin:2px 0 20px}
  @media(min-width:800px){.steps{grid-template-columns:repeat(3,1fr)}}
  .step{background:#fff;border:1px solid var(--line);border-radius:16px;padding:16px}
  .step .num{font-weight:800;color:var(--brand)}

  /* ===== é£Ÿè­œéˆæ„Ÿï¼ˆå¡ç‰‡ï¼‰ ===== */
  .recipes{display:grid;gap:12px;margin:2px 0 20px}
  @media(min-width:800px){.recipes{grid-template-columns:repeat(3,1fr)}}
  .recipe{background:#fff;border:1px solid var(--line);border-radius:16px;padding:14px}
  .illust{height:120px;border-radius:12px;background:linear-gradient(135deg,#fee2e2,#fce7f3);display:grid;place-items:center;font-size:42px;margin-bottom:10px}

  /* ===== å›é¥‹ï¼ˆå…©æ¬„ï¼‰ ===== */
  .testimonials{display:grid;gap:12px;margin:4px 0 20px}
  @media(min-width:800px){.testimonials{grid-template-columns:repeat(2,1fr)}}
  .quote{border-left:3px solid var(--brand);background:#fff;border:1px solid var(--line);padding:12px;border-radius:10px}
  .quote footer{margin-top:6px;color:#64748b}

  /* ===== FAQ ===== */
  details.faq{border:1px solid var(--line);border-radius:12px;padding:10px;background:#fff}
  details.faq + details.faq{margin-top:10px}
  details.faq summary{cursor:pointer;font-weight:600}
</style>

  <!-- å…¨åŸŸéŒ¯èª¤é¡¯ç¤ºï¼ˆä¾¿æ–¼æ’éŒ¯ï¼‰ -->
  <script>
    window.onerror = function(msg, src, line, col) {
      var box = document.getElementById('auth-error');
      if (box) { box.style.display = 'block'; box.textContent = 'å‰ç«¯éŒ¯èª¤ï¼š ' + msg + ' (' + src + ':' + line + ':' + col + ')'; }
    };
  </script>

  <!-- é›™ CDNï¼šå…ˆè¼‰ jsDelivrï¼Œå¤±æ•—å‰‡åˆ‡åˆ° unpkgï¼›è¼‰å…¥å®Œæˆå¾Œæ‰åŸ·è¡Œä¸»ç¨‹å¼ -->
  <script>
    (function loadSupabaseSDK() {
      var primary = "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.4/dist/umd/supabase.min.js";
      var fallback = "https://unpkg.com/@supabase/supabase-js@2.45.4/dist/umd/supabase.min.js";
      function append(src) {
        var s = document.createElement('script');
        s.src = src; s.defer = true;
        s.onload = function(){ window.__supabaseReady = true; };
        s.onerror = function(){
          if (src === primary) {
            append(fallback);
          } else {
            var el = document.getElementById('auth-error');
            if (el) { el.style.display = 'block'; el.textContent = 'è¼‰å…¥ Supabase SDK å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ï¼ˆæˆ–æª¢æŸ¥æ˜¯å¦è¢«ç¶²è·¯æ“‹ä½ CDNï¼‰ã€‚'; }
          }
        };
        document.head.appendChild(s);
      }
      append(primary);
    })();
  </script>
</head>
<body>
<div class="wrap">
  <header>
    <div class="brand">
      <div class="logo">QS</div>
      <div>
        <h1>æˆ’ç³–è¨ˆç•« Quit Sugar</h1>
        <small class="muted">è¼•é¬†é–‹å§‹ã€æŒçºŒè¨˜éŒ„ã€çœ‹è¦‹æ”¹è®Š</small>
      </div>
    </div>
    <div id="auth-quick" class="muted"></div>
  </header>

  <!-- å°è¦½åˆ—ï¼ˆç«™å…§é é¢ï¼‰ -->
  <nav class="top-nav">
    <a href="./">æˆ’ç³–é¦–é </a>
    <a href="./analyzer.html">é£Ÿç‰©å¡è·¯é‡Œåˆ†æå™¨</a>
  </nav>

  <!-- Hero å€ï¼ˆæŸ”å’Œç²‰è‰²ã€æ¸…æ¥š CTAï¼‰ -->
<section class="hero">
  <h2>ä½ çš„è¼•ç”œç”Ÿæ´»ï¼Œå¾ä»Šå¤©é–‹å§‹</h2>
  <p class="muted">å‹å–„èº«é«”çš„æ¸›ç³–è¨ˆç•«ï¼šä¸å¿…æ¥µç«¯ï¼Œå¾ªåºæ¼¸é€²ï¼›çµ¦è‡ªå·± 8 é€±ï¼Œæ›ä¾†æ›´ç©©å®šçš„èƒ½é‡èˆ‡å¥½å¿ƒæƒ…ã€‚</p>
  <div class="actions">
    <a class="btn primary" href="#auth">åŠ å…¥æŒ‘æˆ° / ç™»å…¥</a>
    <a class="btn" href="./analyzer.html">å…ˆè©¦ç”¨é£Ÿç‰©å¡è·¯é‡Œåˆ†æå™¨</a>
  </div>
  <div class="subnav">
    <span class="chip"><a href="#why">ç‚ºä»€éº¼æœ‰æ•ˆ</a></span>
    <span class="chip"><a href="#steps">ä¸‰æ­¥é©Ÿé–‹å§‹</a></span>
    <span class="chip"><a href="#recipes">é£Ÿè­œéˆæ„Ÿ</a></span>
    <span class="chip"><a href="#stories">æˆåŠŸæ•…äº‹</a></span>
    <span class="chip"><a href="#faq">FAQ</a></span>
  </div>
</section>

<!-- å››å¤§é‡é»ï¼ˆå¥³æ€§å‹å–„èªæ°£ï¼‰ -->
<h3 id="why" class="section-title">ç‚ºä»€éº¼é€™å€‹æ–¹æ³•æ›´æº«æŸ”ã€ä¹Ÿæ›´æœ‰æ•ˆï¼Ÿ</h3>
<div class="features">
  <div class="feature">
    <div class="icon">ğŸ’—</div>
    <h4>ä¸å¿…å…¨æˆ–ç„¡</h4>
    <p class="muted">å¾ªåºæ¼¸é€²çš„ä½ç³–ç¯€å¥ï¼Œæ­é…æ›¿ä»£é¸æ“‡ï¼Œå£“åŠ›æ›´å°ã€æˆåŠŸç‡æ›´é«˜ã€‚</p>
  </div>
  <div class="feature">
    <div class="icon">ğŸ¥—</div>
    <h4>å¥½åƒä¹Ÿèƒ½å°‘ç³–</h4>
    <p class="muted">ç°¡å–®æ–™ç†éˆæ„Ÿèˆ‡è¶…å¸‚é¸ç‰©å»ºè­°ï¼Œæ—¥å¸¸å°±èƒ½åšåˆ°ã€‚</p>
  </div>
  <div class="feature">
    <div class="icon">ğŸ§˜â€â™€ï¸</div>
    <h4>èº«å¿ƒä¸€èµ·ç…§é¡§</h4>
    <p class="muted">çµåˆç¡çœ ã€å£“åŠ›èˆ‡ç°¡æ˜“é‹å‹•ï¼Œè®“æ¸´æœ›æ›´å¥½ç®¡ç†ã€‚</p>
  </div>
  <div class="feature">
    <div class="icon">ğŸ“ˆ</div>
    <h4>çœ‹å¾—è¦‹çš„æˆå°±</h4>
    <p class="muted">ç”¨ã€Œé€£å‹å¤©æ•¸ã€èˆ‡ã€Œæœ€é•·ç´€éŒ„ã€è¿½è¹¤é€²æ­¥ï¼Œè¶…æœ‰æˆå°±æ„Ÿã€‚</p>
  </div>
</div>

<!-- ä¸‰æ­¥é©Ÿé–‹å§‹ -->
<h3 id="steps" class="section-title">ä¸‰æ­¥é©Ÿé–‹å§‹ï¼ˆä»Šå¤©å°±èƒ½åšï¼‰</h3>
<div class="steps">
  <div class="step"><div class="num">Step 1</div><strong>ç™»å…¥ä¸¦å»ºç«‹ç›®æ¨™</strong><p class="muted">è¨­å®šä½ çš„èµ·å§‹æ—¥èˆ‡å°ç›®æ¨™ï¼Œå¾ 1% æ”¹è®Šé–‹å§‹ã€‚</p></div>
  <div class="step"><div class="num">Step 2</div><strong>æ¯æ—¥ 1 å€‹å°è¡Œå‹•</strong><p class="muted">ä¾‹å¦‚ï¼šæ™šé¤ä¸å–å«ç³–é£²æ–™ï¼Œæˆ– 20 åˆ†é˜æ•£æ­¥ã€‚</p></div>
  <div class="step"><div class="num">Step 3</div><strong>è¨˜éŒ„æˆå°±ã€æ¯é€±å¾®èª¿</strong><p class="muted">ç”¨ streaks è¿½è¹¤å¤©æ•¸ï¼Œé€æ­¥èª¿æ•´åˆ°èˆ’æœçš„ç¯€å¥ã€‚</p></div>
</div>

<!-- é£Ÿè­œéˆæ„Ÿï¼ˆç¤ºæ„å¡ç‰‡ï¼‰ -->
<h3 id="recipes" class="section-title">æœ¬é€±é£Ÿè­œéˆæ„Ÿ</h3>
<div class="recipes">
  <div class="recipe"><div class="illust">ğŸ¥£</div><strong>æš–èƒƒç‡•éº¥ç¢—</strong><p class="muted">ä½ç³–ç‰ˆæ—©é¤ï¼Œç”œå‘³ä¾†è‡ªé¦™è•‰èˆ‡è‚‰æ¡‚ã€‚</p><a class="btn" href="./analyzer.html">ç”¨åˆ†æå™¨ä¼°å¡è·¯é‡Œ</a></div>
  <div class="recipe"><div class="illust">ğŸ¥—</div><strong>åœ°ä¸­æµ·é®ªé­šæ²™æ‹‰</strong><p class="muted">é«˜è›‹ç™½ã€é«˜çº–ç¶­ï¼Œé£½è¶³æ„Ÿæ›´ä¹…ã€‚</p><a class="btn" href="./analyzer.html">ç”¨åˆ†æå™¨ä¼°å¡è·¯é‡Œ</a></div>
  <div class="recipe"><div class="illust">ğŸ«</div><strong>70% å¯å¯å°é»</strong><p class="muted">æƒ³åƒç”œæ™‚çš„æ›¿ä»£é¸æ“‡ï¼Œæ§åˆ¶ä»½é‡å°±ä¸å…§ç–šã€‚</p><a class="btn" href="./analyzer.html">ç”¨åˆ†æå™¨ä¼°å¡è·¯é‡Œ</a></div>
</div>

<!-- ä½¿ç”¨è€…å›é¥‹ -->
<h3 id="stories" class="section-title">æˆåŠŸæ•…äº‹</h3>
<div class="testimonials">
  <blockquote class="quote"><p>ä¸‰é€±å¾Œå“­è…”ä¸‹åˆå´©å£æ¶ˆå¤±äº†ï¼Œçš®è†šä¹Ÿç©©å®šè¨±å¤šï¼</p><footer>â€” Yumiï¼è¨­è¨ˆå¸«</footer></blockquote>
  <blockquote class="quote"><p>ç”¨ã€Œé€£å‹ã€çœ‹é€²æ­¥ï¼Œæ¯”é«”é‡è¨ˆæ›´æ¿€å‹µï¼›ç¾åœ¨ç”œé£²ä¸€é€±åªå–ä¸€æ¬¡ã€‚</p><footer>â€” Ireneï¼è¡ŒéŠ·äºº</footer></blockquote>
</div>

<!-- FAQ -->
<h3 id="faq" class="section-title">å¸¸è¦‹å•é¡Œ</h3>
<details class="faq"><summary>ä¸€å®šè¦ 8 é€±å—ï¼Ÿ</summary><p class="muted">å»ºè­° 8 é€±ä½œç‚ºå®Œæ•´å¾ªç’°ï¼›ä¹Ÿå¯ä¾ç”Ÿæ´»ç¯€å¥èª¿æ•´ã€‚</p></details>
<details class="faq"><summary>éœ€è¦å®Œå…¨ä¸åƒç³–å—ï¼Ÿ</summary><p class="muted">ä¸ç”¨æ¥µç«¯ï¼›æˆ‘å€‘æ¨ã€Œæ›´å°‘ç³–ã€å°‘åŠ å·¥ã€ï¼ŒæŒçºŒæœ€é‡è¦ã€‚</p></details>

<div class="grid">
    <!-- å·¦ï¼šå…§å®¹/æ¿€å‹µ & ä»£è¾¦ -->
    <section class="card">
      <span class="kicker">åŸºæœ¬åŸå‰‡ & æ¯æ—¥æ¿€å‹µ</span>
      <h2>ä»Šå¤©å°±é–‹å§‹ï¼Œå…ˆåšåˆ° 1 ä»¶å°äº‹</h2>
      <p id="motivation" class="muted">â€¦â€¦</p>
      <h3>å¥åº·è¡Œå‹•æ¸…å–®</h3>
      <div class="list" id="todo-list"></div>
      <div class="row2" style="margin-top:10px">
        <input id="todo-input" placeholder="+ æ–°å¢ä¸€å€‹ä»Šæ—¥å°è¡Œå‹•ï¼Œä¾‹å¦‚ï¼šæ™šé¤ä¸å–å«ç³–é£²æ–™"/>
        <button class="btn" id="todo-add">åŠ å…¥</button>
      </div>
    </section>

    <!-- å³ï¼šç™»å…¥/è¿½è¹¤ -->
    <section id="auth" class="card">
      <span class="kicker">å€‹äººåŒ–è¿½è¹¤</span>
      <h2>è¨»å†Š / ç™»å…¥</h2>
      <div class="row2">
        <input id="signup-email" placeholder="Emailï¼ˆå»ºè­°æ‰‹å‹•è¼¸å…¥ï¼‰" autocomplete="username" />
        <input id="signup-password" placeholder="å¯†ç¢¼ï¼ˆè‡³å°‘ 6 ç¢¼ï¼‰" type="password" autocomplete="new-password" />
      </div>
      <div class="row2" style="margin-top:8px">
        <button class="btn primary" id="btn-signup">è¨»å†Š</button>
        <button class="btn" id="btn-login">ç™»å…¥</button>
      </div>
      <div class="row" style="margin-top:8px">
        <button class="btn ghost" id="btn-logout" style="display:none">ç™»å‡º</button>
      </div>
      <div id="auth-error" class="error" style="display:none;margin-top:10px"></div>

      <hr style="margin:16px -18px;border-color:#e5e7eb;border-style:solid;border-width:1px 0 0"/>

      <h3>æˆ‘çš„æˆ’ç³–é‡Œç¨‹ç¢‘</h3>
      <div class="stat">
        <div>
          <div class="muted">ç•¶å‰é€£å‹ï¼ˆå¤©ï¼‰</div>
          <div class="num" id="current-streak">â€”</div>
        </div>
        <div>
          <div class="muted">æ­·å²æœ€é•·ï¼ˆå¤©ï¼‰</div>
          <div class="num" id="max-streak">â€”</div>
        </div>
      </div>
      <div class="row2" style="margin-top:12px">
        <button class="btn" id="btn-i-did-good">æˆ‘ä»Šå¤©æˆ’ç³– âœ…</button>
        <button class="btn danger" id="btn-reset">æˆ‘å¤±æ‰‹äº†ï¼Œé‡æ–°é–‹å§‹</button>
      </div>
      <small class="muted">æç¤ºï¼šç™»å…¥å¾Œæ‰æœƒå¯«å…¥/è®€å–è³‡æ–™è¡¨ <code>streaks</code>ã€‚</small>
    </section>
  </div>

  <footer>
    <p>Â© 2025 Quit Sugar. GitHub Pages Ã— Supabase</p>
  </footer>
</div>

<script>
  // ====== å»¶é²ç­‰å¾… SDK è¼‰å…¥å®Œæˆ ======
  async function waitSupabaseReady(ms = 4000) {
    const start = Date.now();
    while (!window.supabase && Date.now() - start < ms) {
      await new Promise(r => setTimeout(r, 50));
    }
    return !!window.supabase;
  }

  // ====== UI å°å·¥å…· ======
  const $ = (id) => document.getElementById(id);
  const showErr = (msg) => { const box = document.getElementById('auth-error'); if(!box) return; box.style.display = 'block'; box.textContent = msg; };
  const hideErr = () => { const box = document.getElementById('auth-error'); if(!box) return; box.style.display = 'none'; box.textContent = ''; };

  // ====== Email æ­£è¦åŒ–ï¼ˆé¿å…ã€ŒEmail invalidã€ï¼‰ ======
  function normalizeEmail(raw) {
    return (raw ?? '')
      .normalize('NFKC')
      .replace(/[\u200B-\u200D\uFEFF]/g, '')
      .trim();
  }
  function basicEmailOK(s) { return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s); }

  // ====== æ¿€å‹µèªå¥ ======
  const QUOTES = [
    'å°‘ç³–ä¸€é»ï¼Œæ¸…é†’å¤šä¸€é»ã€‚',
    'ä»Šå¤©çš„ä½ ï¼Œåªè¦æ¯”æ˜¨å¤©æ›´å¥½ 1%ã€‚',
    'æˆ’æ‰ä¸æ˜¯å¿«ç‹ æº–ï¼Œè€Œæ˜¯æŒçºŒåšå°äº‹ã€‚',
    'æƒ³åƒç”œçš„ï¼Ÿå…ˆå–ä¸€æ¯æ°´ï¼Œç­‰äº”åˆ†é˜å†æ±ºå®šã€‚',
    'æŠŠæ¸´æœ›å¯«ä¸‹ä¾†ï¼Œè®“å®ƒé›¢é–‹è…¦è¢‹ã€‚',
  ];
  function pickQuote(){
    const t = QUOTES[Math.floor(Math.random()*QUOTES.length)];
    document.getElementById('motivation').textContent = t;
  }

  // ====== TODOï¼ˆæœ¬åœ°å„²å­˜ï¼‰ ======
  const TODO_KEY = 'qs.todos.v1';
  function readTodos(){ try { return JSON.parse(localStorage.getItem(TODO_KEY)) || []; } catch { return []; } }
  function writeTodos(list){ localStorage.setItem(TODO_KEY, JSON.stringify(list)); renderTodos(); }
  function renderTodos(){
    const list = readTodos();
    const wrap = document.getElementById('todo-list');
    wrap.innerHTML='';
    list.forEach((t,i)=>{
      const row = document.createElement('div');
      row.className = 'todo';
      const cb = document.createElement('input'); cb.type='checkbox'; cb.checked = !!t.done; cb.addEventListener('change',()=>{ list[i].done = cb.checked; writeTodos(list); });
      const span = document.createElement('span'); span.textContent = t.text; span.className='muted';
      const del = document.createElement('button'); del.className='btn ghost'; del.textContent='åˆªé™¤'; del.addEventListener('click',()=>{ list.splice(i,1); writeTodos(list); });
      row.append(cb, span, del);
      wrap.append(row);
    });
  }

  // ====== ä¸»æµç¨‹ ======
  window.addEventListener('DOMContentLoaded', async () => {
    pickQuote();
    renderTodos();

    // ç­‰å¾… Supabase SDK
    const ok = await waitSupabaseReady(4000);
    if (!ok) { showErr('Supabase SDK æœªè¼‰å…¥å®Œæˆï¼Œè«‹é‡æ–°æ•´ç†æˆ–ç¨å¾Œå†è©¦ã€‚'); return; }

    // 1) Supabase é€£ç·šè¨­å®šï¼ˆä½¿ç”¨ä½ çš„å°ˆæ¡ˆè³‡è¨Šï¼‰
    const SUPABASE_URL = "https://scquprvywjtuvcxxfsco.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNjcXVwcnZ5d2p0dXZjeHhmc2NvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU4MzAxMTQsImV4cCI6MjA3MTQwNjExNH0.iUZ_lI-mHoGoz2NfPTifYe44zieUIBUREF6fxsry97I";
    const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
      auth: { persistSession: true, autoRefreshToken: true, detectSessionInUrl: false }
    });

    // Authï¼šè¨»å†Š / ç™»å…¥ / ç™»å‡º
    async function signup(){
      hideErr();
      const email = normalizeEmail(document.getElementById('signup-email').value);
      const password = document.getElementById('signup-password').value;
      if(!basicEmailOK(email)) return showErr('è«‹è¼¸å…¥æœ‰æ•ˆçš„ Emailï¼ˆé¿å…å…¨å½¢èˆ‡å¤šé¤˜ç©ºç™½ï¼‰');
      if((password||'').length < 6) return showErr('å¯†ç¢¼è‡³å°‘ 6 ç¢¼');
      const { data, error } = await supabaseClient.auth.signUp({ email, password });
      if(error){ return showErr('è¨»å†Šå¤±æ•—ï¼š' + (error.message || 'æœªçŸ¥éŒ¯èª¤')); }
      if(!data.session){ return showErr('è‹¥å•Ÿç”¨ä¿¡ç®±é©—è­‰ï¼Œè«‹è‡³ä¿¡ç®±æ”¶ä¿¡å¾Œå†å›ä¾†æŒ‰ã€Œç™»å…¥ã€ã€‚'); }
      await afterLogin();
    }

    async function login(){
      hideErr();
      const email = normalizeEmail(document.getElementById('signup-email').value);
      const password = document.getElementById('signup-password').value;
      if(!basicEmailOK(email)) return showErr('è«‹è¼¸å…¥æœ‰æ•ˆçš„ Email');
      if((password||'').length < 6) return showErr('å¯†ç¢¼è‡³å°‘ 6 ç¢¼');
      const { data, error } = await supabaseClient.auth.signInWithPassword({ email, password });
      if(error){ return showErr('ç™»å…¥å¤±æ•—ï¼š' + (error.message || 'æœªçŸ¥éŒ¯èª¤')); }
      await afterLogin();
    }

    async function logout(){ await supabaseClient.auth.signOut(); renderSession(null); }

    function renderSession(session){
      const quick = document.getElementById('auth-quick');
      const btnLogout = document.getElementById('btn-logout');
      if(session){
        const email = session.user?.email || 'å·²ç™»å…¥';
        quick.textContent = 'ğŸ‘¤ ' + email;
        btnLogout.style.display = 'inline-flex';
      }else{
        quick.textContent = 'æœªç™»å…¥';
        btnLogout.style.display = 'none';
        document.getElementById('current-streak').textContent = 'â€”';
        document.getElementById('max-streak').textContent = 'â€”';
      }
    }

    // Streaks
    function daysBetween(start){
      const s = new Date(start + 'T00:00:00');
      const today = new Date();
      const diff = Math.floor((Date.UTC(today.getFullYear(),today.getMonth(),today.getDate()) - Date.UTC(s.getFullYear(),s.getMonth(),s.getDate())) / (1000*60*60*24));
      return Math.max(0, diff+1);
    }

    async function ensureStreakRow(userId){
      const { data, error } = await supabaseClient.from('streaks').select('*').eq('user_id', userId).maybeSingle();
      if(error){ showErr('è®€å– streaks å¤±æ•—ï¼š' + error.message); return null; }
      if(data){ return data; }
      const today = new Date().toISOString().slice(0,10);
      const { data: inserted, error: e2 } = await supabaseClient.from('streaks').insert({
        user_id: userId,
        current_streak_start_date: today,
        max_streak_days: 0
      }).select().single();
      if(e2){ showErr('å»ºç«‹ streaks å¤±æ•—ï¼š' + e2.message); return null; }
      return inserted;
    }

    async function refreshStreaks(){
      const { data: { session } } = await supabaseClient.auth.getSession();
      if(!session){ return; }
      const row = await ensureStreakRow(session.user.id);
      if(!row) return;
      const current = daysBetween(row.current_streak_start_date);
      document.getElementById('current-streak').textContent = current;
      document.getElementById('max-streak').textContent = row.max_streak_days ?? 0;
    }

    async function markGoodToday(){
      const { data: { session } } = await supabaseClient.auth.getSession();
      if(!session) return showErr('è«‹å…ˆç™»å…¥');
      const row = await ensureStreakRow(session.user.id);
      if(!row) return;
      const current = daysBetween(row.current_streak_start_date);
      const newMax = Math.max(row.max_streak_days ?? 0, current);
      const { error } = await supabaseClient.from('streaks').update({ max_streak_days: newMax }).eq('user_id', session.user.id);
      if(error) return showErr('æ›´æ–°å¤±æ•—ï¼š' + error.message);
      await refreshStreaks();
    }

    async function resetStreak(){
      const { data: { session } } = await supabaseClient.auth.getSession();
      if(!session) return showErr('è«‹å…ˆç™»å…¥');
      const today = new Date().toISOString().slice(0,10);
      const { error } = await supabaseClient.from('streaks').update({ current_streak_start_date: today }).eq('user_id', session.user.id);
      if(error) return showErr('é‡ç½®å¤±æ•—ï¼š' + error.message);
      await refreshStreaks();
    }

    async function afterLogin(){
      const { data: { session } } = await supabaseClient.auth.getSession();
      renderSession(session);
      await refreshStreaks();
    }

    // ç¶å®šäº‹ä»¶
    document.getElementById('todo-add').addEventListener('click', ()=>{
      const v = document.getElementById('todo-input').value.trim();
      if(!v) return;
      const list = readTodos();
      list.unshift({ text:v, done:false });
      writeTodos(list);
      document.getElementById('todo-input').value = '';
    });
    document.getElementById('btn-signup').addEventListener('click', signup);
    document.getElementById('btn-login').addEventListener('click', login);
    document.getElementById('btn-logout').addEventListener('click', logout);
    document.getElementById('btn-i-did-good').addEventListener('click', markGoodToday);
    document.getElementById('btn-reset').addEventListener('click', resetStreak);

    // Session åˆå§‹åŒ–
    const { data: { session } } = await supabaseClient.auth.getSession();
    renderSession(session);
    if(session){ await refreshStreaks(); }

    // ç›£è½ç™»å…¥ç‹€æ…‹
    supabaseClient.auth.onAuthStateChange(function(_evt, sess){ renderSession(sess); if(sess){ refreshStreaks(); } });
  });
</script>

<!-- å¾Œç«¯ä¸€æ¬¡æ€§è¨­å®šå‚™å¿˜ï¼ˆSupabaseï¼‰
1) Auth â†’ Providers â†’ Emailï¼šå•Ÿç”¨ã€‚
   æ¸¬è©¦æœŸå¯åœ¨ Auth â†’ Email é—œé–‰ Confirm emailã€‚
2) Auth â†’ URL Configurationï¼š
   Site URL/Redirect URL éƒ½å¡«ï¼šhttps://abbby9377.github.io/quit-sugar-site/
3) å»ºè¡¨èˆ‡ RLSï¼ˆè‹¥æœªå»ºï¼‰ï¼šåœ¨ SQL Editor åŸ·è¡Œï¼š

  create table if not exists public.streaks (
    id bigint generated by default as identity primary key,
    created_at timestamp with time zone default now(),
    user_id uuid not null default auth.uid() references auth.users(id) on delete cascade,
    current_streak_start_date date not null,
    max_streak_days bigint not null default 0
  );
  alter table public.streaks enable row level security;
  drop policy if exists "streaks_select_own" on public.streaks;
  create policy "streaks_select_own" on public.streaks for select to authenticated using (user_id = auth.uid());
  drop policy if exists "streaks_insert_self" on public.streaks;
  create policy "streaks_insert_self" on public.streaks for insert to authenticated with check (user_id = auth.uid());
  drop policy if exists "streaks_update_own" on public.streaks;
  create policy "streaks_update_own" on public.streaks for update to authenticated using (user_id = auth.uid()) with check (user_id = auth.uid());
  drop policy if exists "streaks_delete_own" on public.streaks;
  create policy "streaks_delete_own" on public.streaks for delete to authenticated using (user_id = auth.uid());
-->
</body>
</html>
